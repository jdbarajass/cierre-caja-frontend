import{l as t}from"./index-C6ssgcke.js";const e=["http://10.28.168.57:5000","http://localhost:5000"],a="https://cierre-caja-api.onrender.com";let o=null;const n=async(t,e,a)=>{const o=new AbortController,n=setTimeout(()=>o.abort(),a);try{const a=await fetch(t,{...e,signal:o.signal});return clearTimeout(n),a}catch(r){throw clearTimeout(n),r}},r=async(r,i={})=>{const s=localStorage.getItem("authToken"),c={"Content-Type":"application/json",...i.headers||{}};s&&(c.Authorization=`Bearer ${s}`);const l={...i,headers:c};let d=null;if(o)try{const t=e.includes(o);if(d=await n(`${o}${r}`,l,t?15e3:8e4),d.ok||401===d.status){if(401===d.status)throw localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Sesión expirada. Por favor inicia sesión nuevamente.");return d}}catch(g){t.warn(`Error al conectar con ${o}:`,g.message),o=null}for(const a of e)try{if(t.info("Intentando conectar con backend local:",a),d=await n(`${a}${r}`,l,15e3),o=a,t.info("Conectado exitosamente con backend local:",a),401===d.status)throw localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Sesión expirada. Por favor inicia sesión nuevamente.");return d}catch(u){t.warn(`Backend local ${a} no disponible`)}t.warn("Todos los backends locales no disponibles, intentando con backend desplegado...");try{if(t.info("Intentando conectar con backend desplegado:",a),d=await n(`${a}${r}`,l,3e4),o=a,t.info("Conectado exitosamente con backend desplegado"),401===d.status)throw localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Sesión expirada. Por favor inicia sesión nuevamente.");return d}catch(m){throw t.error("Todos los backends fallaron:",{locales:e.map(t=>t).join(", "),deployed:a,lastError:m.message}),new Error("No se pudo conectar con ningún servidor. Por favor verifica tu conexión a internet.")}},i=async t=>{const e=await r("/sum_payments",{method:"POST",body:JSON.stringify(t)});if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.message||"Error al procesar el cierre de caja")}return await e.json()},s=()=>{const t=(new Date).toLocaleString("en-US",{timeZone:"America/Bogota",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return new Date(t)},c=()=>{const t=s();return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},l=()=>{const t=s();return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},d=()=>{const t=s();return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}T${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}-05:00`},g=t=>{const[e,a,o]=t.split("-").map(Number);return new Date(e,a-1,o).toLocaleDateString("es-CO",{day:"2-digit",month:"long",year:"numeric"})};export{l as a,d as b,r as c,g as f,c as g,i as s};
