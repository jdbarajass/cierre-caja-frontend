import{l as e,b as s,j as t,a}from"./index-CRxdE6vC.js";import{r,u as l}from"./react-vendor-BQCAaWH2.js";import{g as d}from"./dateUtils-DNdQ6mri.js";import{f as n,A as c,c as i,C as o,U as x,q as m,R as h,T as p,r as g,D as u,F as j,s as y,i as N,B as b,t as v}from"./icons-BheYzHFb.js";const _=5e4,f=()=>{var a,l,u,j;const[y,N]=r.useState(null),[b,v]=r.useState(!1),[f,w]=r.useState(null),[S,k]=r.useState({start_date:"",end_date:d()});r.useEffect(()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-30);const t=s.toISOString().split("T")[0];k(e=>({...e,start_date:t}))},[]);const E=async()=>{if(S.start_date&&S.end_date){v(!0),w(null);try{const t=await(async(t={})=>{try{const a=new URLSearchParams;t.date&&a.append("date",t.date),t.start_date&&a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date);const r=a.toString(),l="/api/analytics/dashboard"+(r?`?${r}`:"");e.info("Obteniendo dashboard completo:",t);const d=await s(l,{method:"GET"},_);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener dashboard")}return await d.json()}catch(f){throw e.error("Error en getAnalyticsDashboard:",f),f}})(S);t.success?N(t.data):w(t.error||"Error al cargar el dashboard")}catch(t){w(t.message||"Error al conectar con el servidor")}finally{v(!1)}}};return r.useEffect(()=>{S.start_date&&S.end_date&&E()},[S]),b?t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center max-w-md px-4",children:[t.jsx(n,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-800 font-semibold mb-2",children:"Procesando an치lisis de ventas..."}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Esto puede tardar hasta 50 segundos dependiendo de la cantidad de facturas."}),t.jsx("p",{className:"text-gray-500 text-xs mt-2",children:"Por favor espera..."})]})}):f?t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(c,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),t.jsx("p",{className:"text-sm",children:f})]})]}),t.jsx("button",{onClick:E,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):y?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-gray-600"}),t.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),t.jsx("input",{type:"date",value:S.start_date,onChange:e=>k(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),t.jsx("span",{className:"text-gray-600",children:"hasta"}),t.jsx("input",{type:"date",value:S.end_date,onChange:e=>k(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),t.jsx("button",{onClick:E,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Actualizar"})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[y.peak_hours&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:t.jsx(o,{className:"w-6 h-6 text-blue-600"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Horas Pico"})]}),y.peak_hours.top_5_peak_hours&&y.peak_hours.top_5_peak_hours[0]&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Mejor hora:"}),t.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.peak_hours.top_5_peak_hours[0].hour_range}),t.jsx("div",{className:"text-sm text-gray-700",children:y.peak_hours.top_5_peak_hours[0].total_revenue_formatted}),t.jsxs("div",{className:"text-xs text-gray-500",children:[y.peak_hours.top_5_peak_hours[0].invoice_count," facturas"]})]})]}),y.top_customers&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:t.jsx(x,{className:"w-6 h-6 text-green-600"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Clientes"})]}),y.top_customers.summary&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Total clientes:"}),t.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.top_customers.summary.total_unique_customers}),t.jsxs("div",{className:"text-sm text-gray-700",children:["Recurrencia: ",null==(a=y.top_customers.summary.recurring_rate)?void 0:a.toFixed(1),"%"]}),t.jsx("div",{className:"text-xs text-gray-500",children:y.top_customers.summary.total_revenue_formatted})]})]}),y.top_sellers&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:t.jsx(m,{className:"w-6 h-6 text-yellow-600"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Vendedoras"})]}),y.top_sellers.top_sellers&&y.top_sellers.top_sellers[0]&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Mejor vendedora:"}),t.jsx("div",{className:"text-lg font-bold text-yellow-600 truncate",children:y.top_sellers.top_sellers[0].seller_name}),t.jsx("div",{className:"text-sm text-gray-700",children:y.top_sellers.top_sellers[0].total_sales_formatted}),t.jsxs("div",{className:"text-xs text-gray-500",children:[y.top_sellers.top_sellers[0].invoice_count," facturas"]})]})]}),y.customer_retention&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:t.jsx(h,{className:"w-6 h-6 text-purple-600"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Retenci칩n"})]}),y.customer_retention.summary&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Tasa de retenci칩n:"}),t.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[null==(l=y.customer_retention.summary.retention_rate)?void 0:l.toFixed(1),"%"]}),t.jsxs("div",{className:"text-sm text-gray-700",children:["Leales: ",y.customer_retention.summary.loyal_customers]}),t.jsxs("div",{className:"text-xs text-gray-500",children:["En riesgo: ",y.customer_retention.summary.at_risk_customers]})]})]}),y.sales_trends&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"p-3 bg-indigo-100 rounded-lg",children:t.jsx(p,{className:"w-6 h-6 text-indigo-600"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tendencias"})]}),y.sales_trends.summary&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Mejor d칤a:"}),t.jsx("div",{className:"text-lg font-bold text-indigo-600",children:null==(u=y.sales_trends.summary.best_day)?void 0:u.day_name}),t.jsx("div",{className:"text-sm text-gray-700",children:null==(j=y.sales_trends.summary.best_day)?void 0:j.total_revenue_formatted}),t.jsxs("div",{className:"text-xs text-gray-500",children:["Promedio: ",y.sales_trends.summary.avg_revenue_per_day_formatted]})]})]}),y.cross_selling&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"p-3 bg-pink-100 rounded-lg",children:t.jsx(g,{className:"w-6 h-6 text-pink-600"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Cross-Selling"})]}),y.cross_selling.summary&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Combos encontrados:"}),t.jsx("div",{className:"text-2xl font-bold text-pink-600",children:y.cross_selling.summary.total_product_pairs}),y.cross_selling.top_product_pairs&&y.cross_selling.top_product_pairs[0]&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Top combo: ",y.cross_selling.top_product_pairs[0].times_bought_together," veces"]}),t.jsx("div",{className:"text-xs text-gray-500 truncate",children:y.cross_selling.top_product_pairs[0].total_revenue_formatted})]})]})]})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsx("p",{className:"text-sm text-blue-800",children:"Selecciona cada secci칩n en el men칰 superior para ver el an치lisis completo con gr치ficos y tablas detalladas."})})]}):t.jsx("div",{className:"text-center text-gray-500 py-12",children:"Selecciona un rango de fechas para ver el dashboard"})},w=()=>{const[a,l]=r.useState(null),[x,m]=r.useState(!1),[h,p]=r.useState(null),[g,y]=r.useState({start_date:"",end_date:d()});r.useEffect(()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-30);const t=s.toISOString().split("T")[0];y(e=>({...e,start_date:t}))},[]);const N=async()=>{if(g.start_date&&g.end_date){m(!0),p(null);try{const t=await(async(t={})=>{try{const a=new URLSearchParams;t.date&&a.append("date",t.date),t.start_date&&a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date);const r=a.toString(),l="/api/analytics/peak-hours"+(r?`?${r}`:"");e.info("Obteniendo horas pico:",t);const d=await s(l,{method:"GET"},_);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener horas pico")}return await d.json()}catch(h){throw e.error("Error en getPeakHours:",h),h}})(g);t.success?l(t.data):p(t.error||"Error al cargar datos")}catch(t){p(t.message||"Error al conectar con el servidor")}finally{m(!1)}}};return r.useEffect(()=>{g.start_date&&g.end_date&&N()},[g]),x?t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx(n,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Cargando horas pico..."})]})}):h?t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(c,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),t.jsx("p",{className:"text-sm",children:h})]})]}),t.jsx("button",{onClick:N,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):a?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-gray-600"}),t.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),t.jsx("input",{type:"date",value:g.start_date,onChange:e=>y(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-600",children:"hasta"}),t.jsx("input",{type:"date",value:g.end_date,onChange:e=>y(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsx("button",{onClick:N,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Actualizar"})]})}),a.summary&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(u,{className:"w-5 h-5 text-green-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Total Ingresos"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.summary.total_revenue_formatted})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(j,{className:"w-5 h-5 text-blue-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Total Facturas"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.summary.total_invoices})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(o,{className:"w-5 h-5 text-purple-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Horas con Ventas"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.summary.hours_with_sales})]})]}),a.top_5_peak_hours&&a.top_5_peak_hours.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Top 5 Horas Pico"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:a.top_5_peak_hours.map((e,s)=>t.jsxs("div",{className:"border-2 rounded-lg p-4 "+(0===s?"border-yellow-400 bg-yellow-50":1===s?"border-gray-400 bg-gray-50":2===s?"border-orange-400 bg-orange-50":"border-gray-200 bg-white"),children:[t.jsx("div",{className:"text-center mb-2",children:t.jsx("span",{className:"text-3xl font-bold",children:0===s?"游볞":1===s?"游볟":2===s?"游볠":`#${s+1}`})}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-lg font-bold text-gray-900",children:e.hour_range}),t.jsx("div",{className:"text-sm font-semibold text-blue-600 mt-2",children:e.total_revenue_formatted}),t.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.invoice_count," facturas"]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Ticket: ",e.average_ticket_formatted]})]})]},e.hour))})]}),a.daily_hourly_breakdown&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Ventas por D칤a de la Semana"}),t.jsx("div",{className:"space-y-4",children:Object.entries(a.daily_hourly_breakdown).map(([e,s])=>s.length>0&&t.jsxs("div",{className:"border-b border-gray-200 last:border-b-0 pb-4 last:pb-0",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:e}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2",children:s.slice(0,6).map(e=>t.jsxs("div",{className:"bg-gray-50 rounded p-2 text-sm",children:[t.jsx("div",{className:"font-semibold text-gray-700",children:e.hour_range}),t.jsx("div",{className:"text-xs text-blue-600",children:e.total_revenue_formatted}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.invoice_count," fact."]})]},e.hour))}),s.length>6&&t.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["+",s.length-6," horas m치s"]})]},e))})]})]}):null},S=()=>{var a;const[l,o]=r.useState(null),[m,h]=r.useState(!1),[p,g]=r.useState(null),[j,N]=r.useState(10),[b,v]=r.useState({start_date:"",end_date:d()});r.useEffect(()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-30);const t=s.toISOString().split("T")[0];v(e=>({...e,start_date:t}))},[]);const f=async()=>{if(b.start_date&&b.end_date){h(!0),g(null);try{const t=await(async(t={})=>{try{const a=new URLSearchParams;t.date&&a.append("date",t.date),t.start_date&&a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date),t.limit&&a.append("limit",t.limit.toString());const r=a.toString(),l="/api/analytics/top-customers"+(r?`?${r}`:"");e.info("Obteniendo top clientes:",t);const d=await s(l,{method:"GET"},_);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener top clientes")}return await d.json()}catch(p){throw e.error("Error en getTopCustomers:",p),p}})({...b,limit:j});t.success?o(t.data):g(t.error||"Error al cargar datos")}catch(t){g(t.message||"Error al conectar con el servidor")}finally{h(!1)}}};return r.useEffect(()=>{b.start_date&&b.end_date&&f()},[b,j]),m?t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx(n,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Cargando top clientes..."})]})}):p?t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(c,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),t.jsx("p",{className:"text-sm",children:p})]})]}),t.jsx("button",{onClick:f,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):l?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-gray-600"}),t.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),t.jsx("input",{type:"date",value:b.start_date,onChange:e=>v(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-600",children:"hasta"}),t.jsx("input",{type:"date",value:b.end_date,onChange:e=>v(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsxs("select",{value:j,onChange:e=>N(Number(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:5,children:"Top 5"}),t.jsx("option",{value:10,children:"Top 10"}),t.jsx("option",{value:20,children:"Top 20"}),t.jsx("option",{value:50,children:"Top 50"})]})]})}),l.summary&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(x,{className:"w-5 h-5 text-blue-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Total Clientes"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l.summary.total_unique_customers})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(u,{className:"w-5 h-5 text-green-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Total Ingresos"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l.summary.total_revenue_formatted})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(y,{className:"w-5 h-5 text-purple-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Ticket Promedio"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l.summary.average_customer_value_formatted})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(x,{className:"w-5 h-5 text-orange-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Recurrencia"})]}),t.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[null==(a=l.summary.recurring_rate)?void 0:a.toFixed(1),"%"]})]})]}),l.top_customers&&l.top_customers.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Top ",l.top_customers.length," Clientes"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rank"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Gastado"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Compras"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ticket Prom."}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"칔ltima Compra"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.top_customers.map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("span",{className:"font-bold "+(0===s?"text-yellow-600":1===s?"text-gray-400":2===s?"text-orange-600":"text-gray-600"),children:["#",s+1]})}),t.jsxs("td",{className:"px-6 py-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.customer_name}),t.jsx("div",{className:"text-xs text-gray-500",children:e.email||"Sin email"})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"text-sm font-semibold text-green-600",children:e.total_spent_formatted})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.purchase_count}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.average_ticket_formatted}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.last_purchase_date}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full "+(e.purchase_count>=5?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:e.purchase_count>=5?"VIP":"Regular"})})]},e.customer_id))})]})})]})]}):null},k=()=>{const[a,l]=r.useState(null),[o,x]=r.useState(!1),[h,p]=r.useState(null),[g,j]=r.useState(10),[y,N]=r.useState({start_date:"",end_date:d()});r.useEffect(()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-30);const t=s.toISOString().split("T")[0];N(e=>({...e,start_date:t}))},[]);const b=async()=>{if(y.start_date&&y.end_date){x(!0),p(null);try{const t=await(async(t={})=>{try{const a=new URLSearchParams;t.date&&a.append("date",t.date),t.start_date&&a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date),t.limit&&a.append("limit",t.limit.toString());const r=a.toString(),l="/api/analytics/top-sellers"+(r?`?${r}`:"");e.info("Obteniendo top vendedoras:",t);const d=await s(l,{method:"GET"},_);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener top vendedoras")}return await d.json()}catch(h){throw e.error("Error en getTopSellers:",h),h}})({...y,limit:g});t.success?l(t.data):p(t.error||"Error al cargar datos")}catch(t){p(t.message||"Error al conectar con el servidor")}finally{x(!1)}}};return r.useEffect(()=>{y.start_date&&y.end_date&&b()},[y,g]),o?t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx(n,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Cargando top vendedoras..."})]})}):h?t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(c,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),t.jsx("p",{className:"text-sm",children:h})]})]}),t.jsx("button",{onClick:b,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):a?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-gray-600"}),t.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),t.jsx("input",{type:"date",value:y.start_date,onChange:e=>N(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-600",children:"hasta"}),t.jsx("input",{type:"date",value:y.end_date,onChange:e=>N(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})}),a.summary&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(u,{className:"w-5 h-5 text-green-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Total Ingresos"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.summary.total_revenue_formatted})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(m,{className:"w-5 h-5 text-yellow-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Promedio por Vendedora"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.summary.average_sales_per_seller_formatted})]})]}),a.top_sellers&&a.top_sellers.length>=3&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Podio de Vendedoras"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-gradient-to-br from-yellow-100 to-yellow-50 rounded-lg p-6 border-2 border-yellow-400",children:[t.jsx("div",{className:"text-center mb-4",children:t.jsx("span",{className:"text-5xl",children:"游볞"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("h4",{className:"font-bold text-gray-900 mb-2",children:a.top_sellers[0].seller_name}),t.jsx("div",{className:"text-2xl font-bold text-yellow-600 mb-2",children:a.top_sellers[0].total_sales_formatted}),t.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[t.jsxs("div",{children:[a.top_sellers[0].invoice_count," facturas"]}),t.jsxs("div",{children:["Ticket: ",a.top_sellers[0].average_ticket_formatted]}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Hora productiva: ",a.top_sellers[0].most_productive_hour]})]})]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-gray-200 to-gray-50 rounded-lg p-6 border-2 border-gray-400",children:[t.jsx("div",{className:"text-center mb-4",children:t.jsx("span",{className:"text-5xl",children:"游볟"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("h4",{className:"font-bold text-gray-900 mb-2",children:a.top_sellers[1].seller_name}),t.jsx("div",{className:"text-2xl font-bold text-gray-600 mb-2",children:a.top_sellers[1].total_sales_formatted}),t.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[t.jsxs("div",{children:[a.top_sellers[1].invoice_count," facturas"]}),t.jsxs("div",{children:["Ticket: ",a.top_sellers[1].average_ticket_formatted]}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Hora productiva: ",a.top_sellers[1].most_productive_hour]})]})]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-orange-100 to-orange-50 rounded-lg p-6 border-2 border-orange-400",children:[t.jsx("div",{className:"text-center mb-4",children:t.jsx("span",{className:"text-5xl",children:"游볠"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("h4",{className:"font-bold text-gray-900 mb-2",children:a.top_sellers[2].seller_name}),t.jsx("div",{className:"text-2xl font-bold text-orange-600 mb-2",children:a.top_sellers[2].total_sales_formatted}),t.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[t.jsxs("div",{children:[a.top_sellers[2].invoice_count," facturas"]}),t.jsxs("div",{children:["Ticket: ",a.top_sellers[2].average_ticket_formatted]}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Hora productiva: ",a.top_sellers[2].most_productive_hour]})]})]})]})]})]}),a.top_sellers&&a.top_sellers.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Ranking Completo"})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Rank"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Vendedora"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Ventas"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Facturas"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ticket Prom."}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Clientes 칔nicos"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Hora Productiva"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.top_sellers.map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("span",{className:"font-bold "+(0===s?"text-yellow-600":1===s?"text-gray-400":2===s?"text-orange-600":"text-gray-600"),children:["#",s+1]})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.seller_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"text-sm font-semibold text-green-600",children:e.total_sales_formatted})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.invoice_count}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.average_ticket_formatted}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.unique_customers}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.most_productive_hour})]},e.seller_id))})]})})]})]}):null},E=()=>{var a;const[l,o]=r.useState(null),[x,m]=r.useState(!1),[h,p]=r.useState(null),[g,u]=r.useState({start_date:"",end_date:d()});r.useEffect(()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-60);const t=s.toISOString().split("T")[0];u(e=>({...e,start_date:t}))},[]);const j=async()=>{if(g.start_date&&g.end_date){m(!0),p(null);try{const t=await(async(t={})=>{try{const a=new URLSearchParams;t.date&&a.append("date",t.date),t.start_date&&a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date);const r=a.toString(),l="/api/analytics/customer-retention"+(r?`?${r}`:"");e.info("Obteniendo retenci칩n de clientes:",t);const d=await s(l,{method:"GET"},_);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener retenci칩n de clientes")}return await d.json()}catch(h){throw e.error("Error en getCustomerRetention:",h),h}})(g);t.success?o(t.data):p(t.error||"Error al cargar datos")}catch(t){p(t.message||"Error al conectar con el servidor")}finally{m(!1)}}};return r.useEffect(()=>{g.start_date&&g.end_date&&j()},[g]),x?t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx(n,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Cargando retenci칩n de clientes..."})]})}):h?t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(c,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),t.jsx("p",{className:"text-sm",children:h})]})]}),t.jsx("button",{onClick:j,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):l?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-gray-600"}),t.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),t.jsx("input",{type:"date",value:g.start_date,onChange:e=>u(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-600",children:"hasta"}),t.jsx("input",{type:"date",value:g.end_date,onChange:e=>u(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})}),l.summary&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Segmentaci칩n de Clientes"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-green-50 border-2 border-green-300 rounded-lg p-6 text-center",children:[t.jsx("h4",{className:"text-lg font-semibold text-green-800 mb-2",children:"Nuevos"}),t.jsx("div",{className:"text-4xl font-bold text-green-600 mb-2",children:l.summary.new_customers}),t.jsx("p",{className:"text-sm text-green-700",children:"1 compra"})]}),t.jsxs("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6 text-center",children:[t.jsx("h4",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Recurrentes"}),t.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:l.summary.recurring_customers}),t.jsx("p",{className:"text-sm text-blue-700",children:"2-4 compras"})]}),t.jsxs("div",{className:"bg-purple-50 border-2 border-purple-300 rounded-lg p-6 text-center",children:[t.jsx("h4",{className:"text-lg font-semibold text-purple-800 mb-2",children:"Leales"}),t.jsx("div",{className:"text-4xl font-bold text-purple-600 mb-2",children:l.summary.loyal_customers}),t.jsx("p",{className:"text-sm text-purple-700",children:"5+ compras"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-lg",children:[t.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-gray-900",children:"Activos"}),t.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.summary.active_customers})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 rounded-lg",children:[t.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded-full"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-gray-900",children:"En Riesgo"}),t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:l.summary.at_risk_customers})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 rounded-lg",children:[t.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-gray-900",children:"Inactivos"}),t.jsx("div",{className:"text-2xl font-bold text-red-600",children:l.summary.inactive_customers})]})]})]}),t.jsxs("div",{className:"mt-6 text-center",children:[t.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Tasa de Retenci칩n"}),t.jsxs("div",{className:"text-5xl font-bold text-purple-600",children:[null==(a=l.summary.retention_rate)?void 0:a.toFixed(1),"%"]})]})]}),l.top_loyal_customers&&l.top_loyal_customers.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Top Clientes Leales"})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Frecuencia"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Gastado"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"칔ltima Compra"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.top_loyal_customers.slice(0,10).map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.customer_name})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.frequency," compras"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"text-sm font-semibold text-green-600",children:e.monetary_formatted})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.last_purchase_date}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full "+("Activo"===e.activity_status?"bg-green-100 text-green-800":"En riesgo"===e.activity_status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.activity_status})})]},e.customer_id))})]})})]}),l.at_risk_customers&&l.at_risk_customers.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(c,{className:"w-5 h-5 text-yellow-600"}),"Clientes en Riesgo"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"D칤as Sin Comprar"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Gastado"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"칔ltima Compra"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.at_risk_customers.slice(0,10).map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.customer_name})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("span",{className:"text-sm font-semibold text-yellow-600",children:[e.recency_days," d칤as"]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.monetary_formatted}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.last_purchase_date})]},e.customer_id))})]})})]})]}):null},C=()=>{var a,l,o,x,m,h;const[g,j]=r.useState(null),[y,N]=r.useState(!1),[b,v]=r.useState(null),[f,w]=r.useState({start_date:"",end_date:d()});r.useEffect(()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-30);const t=s.toISOString().split("T")[0];w(e=>({...e,start_date:t}))},[]);const S=async()=>{if(f.start_date&&f.end_date){N(!0),v(null);try{const t=await(async(t={})=>{try{const a=new URLSearchParams;t.date&&a.append("date",t.date),t.start_date&&a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date);const r=a.toString(),l="/api/analytics/sales-trends"+(r?`?${r}`:"");e.info("Obteniendo tendencias de ventas:",t);const d=await s(l,{method:"GET"},_);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener tendencias de ventas")}return await d.json()}catch(b){throw e.error("Error en getSalesTrends:",b),b}})(f);t.success?j(t.data):v(t.error||"Error al cargar datos")}catch(t){v(t.message||"Error al conectar con el servidor")}finally{N(!1)}}};return r.useEffect(()=>{f.start_date&&f.end_date&&S()},[f]),y?t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx(n,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Cargando tendencias..."})]})}):b?t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(c,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),t.jsx("p",{className:"text-sm",children:b})]})]}),t.jsx("button",{onClick:S,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):g?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-gray-600"}),t.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),t.jsx("input",{type:"date",value:f.start_date,onChange:e=>w(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-600",children:"hasta"}),t.jsx("input",{type:"date",value:f.end_date,onChange:e=>w(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})}),g.summary&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(u,{className:"w-5 h-5 text-green-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Total Per칤odo"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g.summary.total_revenue_formatted})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(p,{className:"w-5 h-5 text-blue-600"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Promedio Diario"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g.summary.avg_revenue_per_day_formatted})]}),t.jsxs("div",{className:"bg-green-50 border-2 border-green-300 rounded-lg p-6",children:[t.jsx("div",{className:"text-sm text-green-700 mb-2",children:"Mejor D칤a"}),t.jsx("div",{className:"font-semibold text-green-900",children:null==(a=g.summary.best_day)?void 0:a.day_name}),t.jsx("div",{className:"text-xl font-bold text-green-600",children:null==(l=g.summary.best_day)?void 0:l.total_revenue_formatted}),t.jsx("div",{className:"text-xs text-green-700 mt-1",children:null==(o=g.summary.best_day)?void 0:o.date})]}),t.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-6",children:[t.jsx("div",{className:"text-sm text-red-700 mb-2",children:"Peor D칤a"}),t.jsx("div",{className:"font-semibold text-red-900",children:null==(x=g.summary.worst_day)?void 0:x.day_name}),t.jsx("div",{className:"text-xl font-bold text-red-600",children:null==(m=g.summary.worst_day)?void 0:m.total_revenue_formatted}),t.jsx("div",{className:"text-xs text-red-700 mt-1",children:null==(h=g.summary.worst_day)?void 0:h.date})]})]}),g.weekday_analysis&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"An치lisis por D칤a de la Semana"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-2",children:g.weekday_analysis.map(e=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:e.day_name}),t.jsx("div",{className:"text-lg font-bold text-blue-600 mb-1",children:e.avg_revenue_per_day_formatted}),t.jsxs("div",{className:"text-xs text-gray-600",children:[e.invoice_count," facturas"]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.days_count," d칤as"]})]},e.day_name))})]}),g.daily_sales&&g.daily_sales.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Ventas Diarias"})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"D칤a"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Facturas"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ticket Prom."})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.daily_sales.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.date}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.day_name}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"text-sm font-semibold text-green-600",children:e.total_revenue_formatted})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.invoice_count}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.average_ticket_formatted})]},e.date))})]})})]})]}):null},T=()=>{const[a,l]=r.useState(null),[o,x]=r.useState(!1),[m,h]=r.useState(null),[p,j]=r.useState(2),[y,N]=r.useState({start_date:"",end_date:d()});r.useEffect(()=>{const e=new Date,s=new Date(e);s.setDate(e.getDate()-30);const t=s.toISOString().split("T")[0];N(e=>({...e,start_date:t}))},[]);const b=async()=>{if(y.start_date&&y.end_date){x(!0),h(null);try{const t=await(async(t={})=>{try{const a=new URLSearchParams;t.date&&a.append("date",t.date),t.start_date&&a.append("start_date",t.start_date),t.end_date&&a.append("end_date",t.end_date),t.min_support&&a.append("min_support",t.min_support.toString());const r=a.toString(),l="/api/analytics/cross-selling"+(r?`?${r}`:"");e.info("Obteniendo cross-selling:",t);const d=await s(l,{method:"GET"},_);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener cross-selling")}return await d.json()}catch(m){throw e.error("Error en getCrossSelling:",m),m}})({...y,min_support:p});t.success?l(t.data):h(t.error||"Error al cargar datos")}catch(t){h(t.message||"Error al conectar con el servidor")}finally{x(!1)}}};return r.useEffect(()=>{y.start_date&&y.end_date&&b()},[y,p]),o?t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx(n,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Cargando an치lisis de cross-selling..."})]})}):m?t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(c,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),t.jsx("p",{className:"text-sm",children:m})]})]}),t.jsx("button",{onClick:b,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):a?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5 text-gray-600"}),t.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),t.jsx("input",{type:"date",value:y.start_date,onChange:e=>N(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-600",children:"hasta"}),t.jsx("input",{type:"date",value:y.end_date,onChange:e=>N(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{className:"text-sm text-gray-700",children:"Soporte m칤nimo:"}),t.jsx("input",{type:"number",min:"1",max:"10",value:p,onChange:e=>j(Number(e.target.value)),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),a.summary&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Resumen"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg",children:[t.jsx(g,{className:"w-8 h-8 text-blue-600"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Combos Encontrados"}),t.jsx("div",{className:"text-3xl font-bold text-blue-600",children:a.summary.total_product_pairs})]})]}),t.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-lg",children:[t.jsx(u,{className:"w-8 h-8 text-purple-600"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Productos 칔nicos"}),t.jsx("div",{className:"text-3xl font-bold text-purple-600",children:a.summary.total_unique_products})]})]})]})]}),a.top_product_pairs&&a.top_product_pairs.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Top Productos que se Compran Juntos"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.top_product_pairs.map((e,s)=>{var a;return t.jsxs("div",{className:"border-2 border-gray-200 rounded-lg p-4 hover:border-blue-400 transition-colors",children:[t.jsx("div",{className:"text-center mb-3",children:t.jsxs("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-800 font-semibold rounded-full text-sm",children:["#",s+1]})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",title:e.product1,children:e.product1}),t.jsx("div",{className:"text-center text-2xl font-bold text-gray-400",children:"+"}),t.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",title:e.product2,children:e.product2})]}),t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Comprados juntos:"}),t.jsxs("span",{className:"font-semibold text-blue-600",children:[e.times_bought_together," veces"]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Ingresos:"}),t.jsx("span",{className:"font-semibold text-green-600",children:e.total_revenue_formatted})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Confianza:"}),t.jsxs("span",{className:"font-semibold text-purple-600",children:[null==(a=e.avg_confidence)?void 0:a.toFixed(1),"%"]})]})]})]},s)})})]}),a.top_product_pairs&&a.top_product_pairs.length>0&&t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Sugerencia:"})," Estos pares de productos se compran frecuentemente juntos. Considera crear combos o promociones para incrementar las ventas."]})}),a.top_product_pairs&&0===a.top_product_pairs.length&&t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center",children:t.jsxs("p",{className:"text-yellow-800",children:["No se encontraron pares de productos con el soporte m칤nimo de ",p,". Intenta reducir el soporte m칤nimo o ampliar el rango de fechas."]})})]}):null},D=()=>{const e=l(),[s,d]=r.useState("dashboard");a((()=>{switch(s){case"dashboard":return"Analytics - Dashboard Completo";case"peak-hours":return"Analytics - Horas Pico";case"top-customers":return"Analytics - Top Clientes";case"top-sellers":return"Analytics - Top Vendedoras";case"retention":return"Analytics - Retenci칩n de Clientes";case"trends":return"Analytics - Tendencias de Ventas";case"cross-selling":return"Analytics - Cross-Selling";default:return"Analytics Avanzado"}})());const n=[{id:"dashboard",label:"Dashboard Completo",icon:v,description:"Vista unificada de KPIs"},{id:"peak-hours",label:"Horas Pico",icon:o,description:"Mejores horas de venta"},{id:"top-customers",label:"Top Clientes",icon:x,description:"Clientes que m치s compran"},{id:"top-sellers",label:"Top Vendedoras",icon:m,description:"Vendedoras destacadas"},{id:"retention",label:"Retenci칩n",icon:h,description:"An치lisis RFM"},{id:"trends",label:"Tendencias",icon:p,description:"Patrones de venta"},{id:"cross-selling",label:"Cross-Selling",icon:g,description:"Productos relacionados"}];return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:[t.jsx("div",{className:"bg-white shadow-md border-b border-gray-200",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>{e("/dashboard")},className:"p-2 hover:bg-gray-100 rounded-lg transition-all",title:"Volver al Dashboard",children:t.jsx(N,{className:"w-6 h-6 text-gray-600"})}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(b,{className:"w-7 h-7 text-blue-600"}),"Analytics Avanzado"]}),t.jsx("p",{className:"text-sm text-gray-600",children:"An치lisis inteligente de ventas"})]})]})})})}),t.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4",children:t.jsx("div",{className:"flex gap-2 overflow-x-auto py-2",children:n.map(e=>{const a=e.icon,r=s===e.id;return t.jsxs("button",{onClick:()=>d(e.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg whitespace-nowrap transition-all "+(r?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[t.jsx(a,{className:"w-4 h-4 "+(r?"text-white":"text-gray-600")}),t.jsxs("div",{className:"text-left",children:[t.jsx("div",{className:"text-sm font-semibold "+(r?"text-white":"text-gray-900"),children:e.label}),t.jsx("div",{className:"text-xs "+(r?"text-blue-100":"text-gray-500"),children:e.description})]})]},e.id)})})})}),t.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:(()=>{switch(s){case"dashboard":default:return t.jsx(f,{});case"peak-hours":return t.jsx(w,{});case"top-customers":return t.jsx(S,{});case"top-sellers":return t.jsx(k,{});case"retention":return t.jsx(E,{});case"trends":return t.jsx(C,{});case"cross-selling":return t.jsx(T,{})}})()})]})};export{D as default};
