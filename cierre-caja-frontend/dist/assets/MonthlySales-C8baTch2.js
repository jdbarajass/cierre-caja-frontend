import{l as e,j as s}from"./index-D7AFDFkb.js";import{r as t,u as a}from"./react-vendor-emGiN04W.js";import{c as l,g as r}from"./dateUtils-BXo8lpHW.js";import{d,A as n,R as o,g as i,T as c,b as m,D as x,F as h,c as u}from"./icons-ByAfuB2N.js";const g=()=>{const g=a(),b=r(),p=b.substring(0,8)+"01",[j,f]=t.useState(p),[N,y]=t.useState(b),{data:v,loading:w,error:_,refetch:F}=((s=null,a=null)=>{const[r,d]=t.useState(null),[n,o]=t.useState(!0),[i,c]=t.useState(null),m=async()=>{try{o(!0),c(null);const t=new URLSearchParams;s&&t.append("start_date",s),a&&t.append("end_date",a);const r="/api/monthly_sales"+(t.toString()?"?"+t.toString():"");e.info("Intentando obtener ventas mensuales:",r);const n=18e4,i=await l(r,{method:"GET"},n);if(!i.ok){const e=await i.json();throw new Error(e.error||e.message||"Error al obtener ventas mensuales")}const m=await i.json();e.info("Ventas mensuales obtenidas exitosamente:",m),d(m)}catch(t){c(t.message)}finally{o(!1)}};return t.useEffect(()=>{m()},[s,a]),{data:r,loading:n,error:i,refetch:()=>{m()}}})(j,N),C=(e,s)=>0===s?"0.0":(e/s*100).toFixed(1),S=()=>{g("/dashboard")};if(w)return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",children:s.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-lg max-w-md",children:s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx(d,{className:"w-12 h-12 text-blue-600 animate-spin"}),s.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:"Procesando facturas..."}),s.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Estamos consultando todas las facturas del periodo en Alegra."}),s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-2",children:s.jsxs("p",{className:"text-sm text-yellow-800 text-center",children:["⏱️ ",s.jsx("strong",{children:"Este proceso puede tardar 1-3 minutos"})," dependiendo de la cantidad de facturas."]})}),s.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Por favor no cierres esta ventana"})]})})});if(_)return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-lg max-w-md w-full",children:s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(n,{className:"w-10 h-10 text-red-600"})}),s.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Error al cargar datos"}),s.jsx("p",{className:"text-gray-600 text-center",children:_}),s.jsxs("div",{className:"flex gap-3 mt-4",children:[s.jsxs("button",{onClick:F,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all flex items-center gap-2",children:[s.jsx(o,{className:"w-4 h-4"}),"Reintentar"]}),s.jsx("button",{onClick:S,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all",children:"Volver"})]})]})})});if(!v)return null;const P=(k=v.total_vendido.total,0===(E=v.cantidad_facturas)?0:k/E);var k,E,V;return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 py-8 px-4",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:S,className:"p-2 hover:bg-white rounded-lg transition-all",title:"Volver al Dashboard",children:s.jsx(i,{className:"w-6 h-6 text-gray-600"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[s.jsx(c,{className:"w-8 h-8 text-blue-600"}),"Ventas Mensuales"]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Consulta de ventas desde Alegra"})]})]}),s.jsxs("button",{onClick:F,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all shadow-md",children:[s.jsx(o,{className:"w-4 h-4"}),"Actualizar"]})]}),s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(m,{className:"w-5 h-5 text-purple-600"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Seleccionar Periodo"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Inicio"}),s.jsx("input",{type:"date",value:j,onChange:e=>f(e.target.value),max:N,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Fin"}),s.jsx("input",{type:"date",value:N,onChange:e=>y(e.target.value),min:j,max:b,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),s.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"Periodo seleccionado:"})," ",v.date_range.start," al ",v.date_range.end]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl shadow-lg p-6 text-white",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsx(x,{className:"w-8 h-8 opacity-80"})}),s.jsx("h3",{className:"text-sm font-medium opacity-90 mb-1",children:"Total Vendido"}),s.jsx("p",{className:"text-3xl font-bold mb-2",children:v.total_vendido.formatted}),s.jsxs("p",{className:"text-xs opacity-75",children:[v.date_range.start," - ",v.date_range.end]})]}),s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-gray-100",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsx(h,{className:"w-8 h-8 text-green-600"})}),s.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Facturas Generadas"}),s.jsx("p",{className:"text-3xl font-bold text-gray-900 mb-2",children:v.cantidad_facturas}),s.jsx("p",{className:"text-xs text-gray-500",children:"Facturas en el periodo"})]}),s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-gray-100",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsx(c,{className:"w-8 h-8 text-orange-600"})}),s.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Promedio por Factura"}),s.jsx("p",{className:"text-3xl font-bold text-gray-900 mb-2",children:(V=P,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(V))}),s.jsx("p",{className:"text-xs text-gray-500",children:"Venta promedio"})]})]}),s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[s.jsx(u,{className:"w-5 h-5 text-indigo-600"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Desglose por Método de Pago"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border border-green-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-sm font-semibold text-green-900",children:v.payment_methods.cash.label}),s.jsxs("span",{className:"text-xs font-bold text-green-700 bg-green-200 px-2 py-1 rounded",children:[C(v.payment_methods.cash.total,v.total_vendido.total),"%"]})]}),s.jsx("p",{className:"text-2xl font-bold text-green-700 mb-1",children:v.payment_methods.cash.formatted}),s.jsx("div",{className:"w-full bg-green-200 rounded-full h-2",children:s.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${C(v.payment_methods.cash.total,v.total_vendido.total)}%`}})})]}),s.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-sm font-semibold text-purple-900",children:v.payment_methods.transfer.label}),s.jsxs("span",{className:"text-xs font-bold text-purple-700 bg-purple-200 px-2 py-1 rounded",children:[C(v.payment_methods.transfer.total,v.total_vendido.total),"%"]})]}),s.jsx("p",{className:"text-2xl font-bold text-purple-700 mb-1",children:v.payment_methods.transfer.formatted}),s.jsx("div",{className:"w-full bg-purple-200 rounded-full h-2",children:s.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${C(v.payment_methods.transfer.total,v.total_vendido.total)}%`}})})]}),s.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-sm font-semibold text-blue-900",children:v.payment_methods["credit-card"].label}),s.jsxs("span",{className:"text-xs font-bold text-blue-700 bg-blue-200 px-2 py-1 rounded",children:[C(v.payment_methods["credit-card"].total,v.total_vendido.total),"%"]})]}),s.jsx("p",{className:"text-2xl font-bold text-blue-700 mb-1",children:v.payment_methods["credit-card"].formatted}),s.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${C(v.payment_methods["credit-card"].total,v.total_vendido.total)}%`}})})]}),s.jsxs("div",{className:"bg-orange-50 rounded-xl p-4 border border-orange-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-sm font-semibold text-orange-900",children:v.payment_methods["debit-card"].label}),s.jsxs("span",{className:"text-xs font-bold text-orange-700 bg-orange-200 px-2 py-1 rounded",children:[C(v.payment_methods["debit-card"].total,v.total_vendido.total),"%"]})]}),s.jsx("p",{className:"text-2xl font-bold text-orange-700 mb-1",children:v.payment_methods["debit-card"].formatted}),s.jsx("div",{className:"w-full bg-orange-200 rounded-full h-2",children:s.jsx("div",{className:"bg-orange-600 h-2 rounded-full",style:{width:`${C(v.payment_methods["debit-card"].total,v.total_vendido.total)}%`}})})]})]})]}),s.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl",children:s.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Usuario Alegra:"})," ",v.username_used]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Timestamp del servidor:"})," ",v.server_timestamp]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Zona horaria:"})," ",v.timezone]})]})})]})})};export{g as default};
