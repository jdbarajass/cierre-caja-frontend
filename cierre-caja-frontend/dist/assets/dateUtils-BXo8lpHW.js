import{l as e}from"./index-D7AFDFkb.js";const t=["http://10.28.168.57:5000","http://localhost:5000"],n="https://cierre-caja-api.onrender.com";let o=null;const a=async(e,t,n)=>{const o=new AbortController,a=setTimeout(()=>o.abort(),n);try{const n=await fetch(e,{...t,signal:o.signal});return clearTimeout(a),n}catch(r){throw clearTimeout(a),r}},r=async(r,s={},i=null)=>{const c=secureGetItem("authToken"),d={"Content-Type":"application/json",...s.headers||{}};c&&(d.Authorization=`Bearer ${c}`);const l={...s,headers:d};let u=null;const h=(()=>{const e=window.location.hostname;return!["onrender.com","netlify.app","vercel.app","github.io","herokuapp.com","railway.app","fly.dev"].some(t=>e.endsWith(t)||e.includes(t))&&("localhost"===e||"127.0.0.1"===e||e.startsWith("192.168.")||e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("172.17.")||e.startsWith("172.18.")||e.startsWith("172.19.")||e.startsWith("172.2")||e.startsWith("172.30.")||e.startsWith("172.31."))})();if(h?e.info("Frontend en entorno LOCAL - Prioridad: backends locales"):e.info("Frontend en entorno DESPLEGADO - Usando solo backend desplegado"),o)if(h||o===n)try{const e=t.includes(o),n=i||(e?15e3:8e4);if(u=await a(`${o}${r}`,l,n),u.ok||401===u.status){if(401===u.status)throw secureRemoveItem("authToken"),secureRemoveItem("authUser"),window.location.href="/login",new Error("Sesión expirada. Por favor inicia sesión nuevamente.");return u}}catch(g){e.warn(`Error al conectar con ${o}:`,g.message),o=null}else o=null;if(h){for(const n of t)try{e.info("Intentando conectar con backend local:",n);const t=i||15e3;if(u=await a(`${n}${r}`,l,t),o=n,e.info("Conectado exitosamente con backend local:",n),401===u.status)throw secureRemoveItem("authToken"),secureRemoveItem("authUser"),window.location.href="/login",new Error("Sesión expirada. Por favor inicia sesión nuevamente.");return u}catch(m){e.warn(`Backend local ${n} no disponible`)}e.warn("Backends locales no disponibles, intentando con backend desplegado como fallback...")}try{e.info("Conectando con backend desplegado:",n);const t=i||3e4;if(u=await a(`${n}${r}`,l,t),o=n,e.info("Conectado exitosamente con backend desplegado"),401===u.status)throw secureRemoveItem("authToken"),secureRemoveItem("authUser"),window.location.href="/login",new Error("Sesión expirada. Por favor inicia sesión nuevamente.");return u}catch(p){const o=h?{locales:t.join(", "),deployed:n,lastError:p.message}:{deployed:n,lastError:p.message};throw e.error("Error de conexión:",o),new Error("No se pudo conectar con el servidor. Por favor verifica tu conexión a internet.")}},s=async e=>{const t=await r("/api/sum_payments",{method:"POST",body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.message||"Error al procesar el cierre de caja")}return await t.json()},i=()=>{const e=(new Date).toLocaleString("en-US",{timeZone:"America/Bogota",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return new Date(e)},c=()=>{const e=i();return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},d=()=>{const e=i();return`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`},l=()=>{const e=i();return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}-05:00`},u=e=>{const[t,n,o]=e.split("-").map(Number);return new Date(t,n-1,o).toLocaleDateString("es-CO",{day:"2-digit",month:"long",year:"numeric"})};export{d as a,l as b,r as c,u as f,c as g,s};
