import{l as e,b as s,j as a,a as t}from"./index-Cb6VZzXE.js";import{r,u as l}from"./react-vendor-BQCAaWH2.js";import{f as d,A as n,c,C as i,U as o,q as x,R as m,T as h,r as p,D as g,F as u,s as j,i as b,B as y,t as N}from"./icons-BheYzHFb.js";const v=5e4,f=()=>{var t,l,g,u;const[j,b]=r.useState(null),[y,N]=r.useState(!1),[f,_]=r.useState(null),[w,k]=r.useState({start_date:"",end_date:""}),C=async()=>{if(w.start_date&&w.end_date){N(!0),_(null);try{const a=await(async(a={})=>{try{const t=new URLSearchParams;a.date&&t.append("date",a.date),a.start_date&&t.append("start_date",a.start_date),a.end_date&&t.append("end_date",a.end_date);const r=t.toString(),l="/api/analytics/dashboard"+(r?`?${r}`:"");e.info("Obteniendo dashboard completo:",a);const d=await s(l,{method:"GET"},v);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener dashboard")}return await d.json()}catch(f){throw e.error("Error en getAnalyticsDashboard:",f),f}})(w);a.success?b(a.data):_(a.error||"Error al cargar el dashboard")}catch(a){_(a.message||"Error al conectar con el servidor")}finally{N(!1)}}else _("Por favor selecciona ambas fechas para consultar")};return y?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"text-center max-w-md px-4",children:[a.jsx(d,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-800 font-semibold mb-2",children:"Procesando an치lisis de ventas..."}),a.jsx("p",{className:"text-gray-600 text-sm",children:"Esto puede tardar hasta 50 segundos dependiendo de la cantidad de facturas."}),a.jsx("p",{className:"text-gray-500 text-xs mt-2",children:"Por favor espera..."})]})}):f?a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[a.jsx(n,{className:"w-6 h-6"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),a.jsx("p",{className:"text-sm",children:f})]})]}),a.jsx("button",{onClick:C,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):j?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),a.jsx("input",{type:"date",value:w.start_date,onChange:e=>k(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),a.jsx("span",{className:"text-gray-600",children:"hasta"}),a.jsx("input",{type:"date",value:w.end_date,onChange:e=>k(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),a.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Consultar Per칤odo"})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[j.peak_hours&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:a.jsx(i,{className:"w-6 h-6 text-blue-600"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Horas Pico"})]}),j.peak_hours.top_5_peak_hours&&j.peak_hours.top_5_peak_hours[0]&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Mejor hora:"}),a.jsx("div",{className:"text-2xl font-bold text-blue-600",children:j.peak_hours.top_5_peak_hours[0].hour_range}),a.jsx("div",{className:"text-sm text-gray-700",children:j.peak_hours.top_5_peak_hours[0].total_revenue_formatted}),a.jsxs("div",{className:"text-xs text-gray-500",children:[j.peak_hours.top_5_peak_hours[0].invoice_count," facturas"]})]})]}),j.top_customers&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:a.jsx(o,{className:"w-6 h-6 text-green-600"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Clientes"})]}),j.top_customers.summary&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Total clientes:"}),a.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.top_customers.summary.total_unique_customers}),a.jsxs("div",{className:"text-sm text-gray-700",children:["Recurrencia: ",null==(t=j.top_customers.summary.recurring_rate)?void 0:t.toFixed(1),"%"]}),a.jsx("div",{className:"text-xs text-gray-500",children:j.top_customers.summary.total_revenue_formatted})]})]}),j.top_sellers&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:a.jsx(x,{className:"w-6 h-6 text-yellow-600"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top Vendedoras"})]}),j.top_sellers.top_sellers&&j.top_sellers.top_sellers[0]&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Mejor vendedora:"}),a.jsx("div",{className:"text-lg font-bold text-yellow-600 truncate",children:j.top_sellers.top_sellers[0].seller_name}),a.jsx("div",{className:"text-sm text-gray-700",children:j.top_sellers.top_sellers[0].total_sales_formatted}),a.jsxs("div",{className:"text-xs text-gray-500",children:[j.top_sellers.top_sellers[0].invoice_count," facturas"]})]})]}),j.customer_retention&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:a.jsx(m,{className:"w-6 h-6 text-purple-600"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Retenci칩n"})]}),j.customer_retention.summary&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Tasa de retenci칩n:"}),a.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[null==(l=j.customer_retention.summary.retention_rate)?void 0:l.toFixed(1),"%"]}),a.jsxs("div",{className:"text-sm text-gray-700",children:["Leales: ",j.customer_retention.summary.loyal_customers]}),a.jsxs("div",{className:"text-xs text-gray-500",children:["En riesgo: ",j.customer_retention.summary.at_risk_customers]})]})]}),j.sales_trends&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-3 bg-indigo-100 rounded-lg",children:a.jsx(h,{className:"w-6 h-6 text-indigo-600"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tendencias"})]}),j.sales_trends.summary&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Mejor d칤a:"}),a.jsx("div",{className:"text-lg font-bold text-indigo-600",children:null==(g=j.sales_trends.summary.best_day)?void 0:g.day_name}),a.jsx("div",{className:"text-sm text-gray-700",children:null==(u=j.sales_trends.summary.best_day)?void 0:u.total_revenue_formatted}),a.jsxs("div",{className:"text-xs text-gray-500",children:["Promedio: ",j.sales_trends.summary.avg_revenue_per_day_formatted]})]})]}),j.cross_selling&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-3 bg-pink-100 rounded-lg",children:a.jsx(p,{className:"w-6 h-6 text-pink-600"})}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Cross-Selling"})]}),j.cross_selling.summary&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Combos encontrados:"}),a.jsx("div",{className:"text-2xl font-bold text-pink-600",children:j.cross_selling.summary.total_product_pairs}),j.cross_selling.top_product_pairs&&j.cross_selling.top_product_pairs[0]&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"text-sm text-gray-700",children:["Top combo: ",j.cross_selling.top_product_pairs[0].times_bought_together," veces"]}),a.jsx("div",{className:"text-xs text-gray-500 truncate",children:j.cross_selling.top_product_pairs[0].total_revenue_formatted})]})]})]})]}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsx("p",{className:"text-sm text-blue-800",children:"Selecciona cada secci칩n en el men칰 superior para ver el an치lisis completo con gr치ficos y tablas detalladas."})})]}):a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),a.jsx("input",{type:"date",value:w.start_date,onChange:e=>k(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),a.jsx("span",{className:"text-gray-600",children:"hasta"}),a.jsx("input",{type:"date",value:w.end_date,onChange:e=>k(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),a.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Consultar Per칤odo"})]})}),a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-8 text-center",children:[a.jsx(c,{className:"w-16 h-16 text-blue-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Selecciona un per칤odo para consultar"}),a.jsx("p",{className:"text-blue-700",children:'Elige la fecha de inicio y fecha de fin, luego presiona "Consultar Per칤odo" para ver el an치lisis completo.'})]})]})},_=()=>{const[t,l]=r.useState(null),[o,x]=r.useState(!1),[m,h]=r.useState(null),[p,j]=r.useState({start_date:"",end_date:""}),b=async()=>{if(p.start_date&&p.end_date){x(!0),h(null);try{const a=await(async(a={})=>{try{const t=new URLSearchParams;a.date&&t.append("date",a.date),a.start_date&&t.append("start_date",a.start_date),a.end_date&&t.append("end_date",a.end_date);const r=t.toString(),l="/api/analytics/peak-hours"+(r?`?${r}`:"");e.info("Obteniendo horas pico:",a);const d=await s(l,{method:"GET"},v);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener horas pico")}return await d.json()}catch(m){throw e.error("Error en getPeakHours:",m),m}})(p);a.success?l(a.data):h(a.error||"Error al cargar datos")}catch(a){h(a.message||"Error al conectar con el servidor")}finally{x(!1)}}else h("Por favor selecciona ambas fechas para consultar")};return o?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(d,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Cargando horas pico..."})]})}):m?a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[a.jsx(n,{className:"w-6 h-6"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),a.jsx("p",{className:"text-sm",children:m})]})]}),a.jsx("button",{onClick:b,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):t?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),a.jsx("input",{type:"date",value:p.start_date,onChange:e=>j(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),a.jsx("span",{className:"text-gray-600",children:"hasta"}),a.jsx("input",{type:"date",value:p.end_date,onChange:e=>j(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),a.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Consultar Per칤odo"})]})}),t.summary&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(g,{className:"w-5 h-5 text-green-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Total Ingresos"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.summary.total_revenue_formatted})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(u,{className:"w-5 h-5 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Total Facturas"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.summary.total_invoices})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(i,{className:"w-5 h-5 text-purple-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Horas con Ventas"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.summary.hours_with_sales})]})]}),t.top_5_peak_hours&&t.top_5_peak_hours.length>0&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Top 5 Horas Pico"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:t.top_5_peak_hours.map((e,s)=>a.jsxs("div",{className:"border-2 rounded-lg p-4 "+(0===s?"border-yellow-400 bg-yellow-50":1===s?"border-gray-400 bg-gray-50":2===s?"border-orange-400 bg-orange-50":"border-gray-200 bg-white"),children:[a.jsx("div",{className:"text-center mb-2",children:a.jsx("span",{className:"text-3xl font-bold",children:0===s?"游볞":1===s?"游볟":2===s?"游볠":`#${s+1}`})}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-lg font-bold text-gray-900",children:e.hour_range}),a.jsx("div",{className:"text-sm font-semibold text-blue-600 mt-2",children:e.total_revenue_formatted}),a.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[e.invoice_count," facturas"]}),a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Ticket: ",e.average_ticket_formatted]})]})]},e.hour))})]}),t.daily_hourly_breakdown&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Ventas por D칤a de la Semana"}),a.jsx("div",{className:"space-y-4",children:Object.entries(t.daily_hourly_breakdown).map(([e,s])=>s.length>0&&a.jsxs("div",{className:"border-b border-gray-200 last:border-b-0 pb-4 last:pb-0",children:[a.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:e}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2",children:s.slice(0,6).map(e=>a.jsxs("div",{className:"bg-gray-50 rounded p-2 text-sm",children:[a.jsx("div",{className:"font-semibold text-gray-700",children:e.hour_range}),a.jsx("div",{className:"text-xs text-blue-600",children:e.total_revenue_formatted}),a.jsxs("div",{className:"text-xs text-gray-500",children:[e.invoice_count," fact."]})]},e.hour))}),s.length>6&&a.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["+",s.length-6," horas m치s"]})]},e))})]})]}):null},w=()=>{var t;const[l,i]=r.useState(null),[x,m]=r.useState(!1),[h,p]=r.useState(null),[u,b]=r.useState(10),[y,N]=r.useState({start_date:"",end_date:""}),f=async()=>{if(y.start_date&&y.end_date){m(!0),p(null);try{const a=await(async(a={})=>{try{const t=new URLSearchParams;a.date&&t.append("date",a.date),a.start_date&&t.append("start_date",a.start_date),a.end_date&&t.append("end_date",a.end_date),a.limit&&t.append("limit",a.limit.toString());const r=t.toString(),l="/api/analytics/top-customers"+(r?`?${r}`:"");e.info("Obteniendo top clientes:",a);const d=await s(l,{method:"GET"},v);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener top clientes")}return await d.json()}catch(h){throw e.error("Error en getTopCustomers:",h),h}})({...y,limit:u});a.success?i(a.data):p(a.error||"Error al cargar datos")}catch(a){p(a.message||"Error al conectar con el servidor")}finally{m(!1)}}else p("Por favor selecciona ambas fechas para consultar")};return x?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(d,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Cargando top clientes..."})]})}):h?a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[a.jsx(n,{className:"w-6 h-6"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),a.jsx("p",{className:"text-sm",children:h})]})]}),a.jsx("button",{onClick:f,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):l?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),a.jsx("input",{type:"date",value:y.start_date,onChange:e=>N(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),a.jsx("span",{className:"text-gray-600",children:"hasta"}),a.jsx("input",{type:"date",value:y.end_date,onChange:e=>N(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),a.jsxs("select",{value:u,onChange:e=>b(Number(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:5,children:"Top 5"}),a.jsx("option",{value:10,children:"Top 10"}),a.jsx("option",{value:20,children:"Top 20"}),a.jsx("option",{value:50,children:"Top 50"})]})]})}),l.summary&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(o,{className:"w-5 h-5 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Total Clientes"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l.summary.total_unique_customers})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(g,{className:"w-5 h-5 text-green-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Total Ingresos"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l.summary.total_revenue_formatted})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(j,{className:"w-5 h-5 text-purple-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Ticket Promedio"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l.summary.average_customer_value_formatted})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(o,{className:"w-5 h-5 text-orange-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Recurrencia"})]}),a.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[null==(t=l.summary.recurring_rate)?void 0:t.toFixed(1),"%"]})]})]}),l.top_customers&&l.top_customers.length>0&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b border-gray-200",children:a.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Top ",l.top_customers.length," Clientes"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rank"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Gastado"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Compras"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ticket Prom."}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"칔ltima Compra"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.top_customers.map((e,s)=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("span",{className:"font-bold "+(0===s?"text-yellow-600":1===s?"text-gray-400":2===s?"text-orange-600":"text-gray-600"),children:["#",s+1]})}),a.jsxs("td",{className:"px-6 py-4",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.customer_name}),a.jsx("div",{className:"text-xs text-gray-500",children:e.email||"Sin email"})]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"text-sm font-semibold text-green-600",children:e.total_spent_formatted})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.purchase_count}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.average_ticket_formatted}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.last_purchase_date}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full "+(e.purchase_count>=5?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:e.purchase_count>=5?"VIP":"Regular"})})]},e.customer_id))})]})})]})]}):null},k=()=>{const[t,l]=r.useState(null),[i,o]=r.useState(!1),[m,h]=r.useState(null),[p,u]=r.useState(10),[j,b]=r.useState({start_date:"",end_date:""}),y=async()=>{if(j.start_date&&j.end_date){o(!0),h(null);try{const a=await(async(a={})=>{try{const t=new URLSearchParams;a.date&&t.append("date",a.date),a.start_date&&t.append("start_date",a.start_date),a.end_date&&t.append("end_date",a.end_date),a.limit&&t.append("limit",a.limit.toString());const r=t.toString(),l="/api/analytics/top-sellers"+(r?`?${r}`:"");e.info("Obteniendo top vendedoras:",a);const d=await s(l,{method:"GET"},v);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener top vendedoras")}return await d.json()}catch(m){throw e.error("Error en getTopSellers:",m),m}})({...j,limit:p});a.success?l(a.data):h(a.error||"Error al cargar datos")}catch(a){h(a.message||"Error al conectar con el servidor")}finally{o(!1)}}else h("Por favor selecciona ambas fechas para consultar")};return i?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(d,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Cargando top vendedoras..."})]})}):m?a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[a.jsx(n,{className:"w-6 h-6"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),a.jsx("p",{className:"text-sm",children:m})]})]}),a.jsx("button",{onClick:y,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):t?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),a.jsx("input",{type:"date",value:j.start_date,onChange:e=>b(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),a.jsx("span",{className:"text-gray-600",children:"hasta"}),a.jsx("input",{type:"date",value:j.end_date,onChange:e=>b(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})}),t.summary&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(g,{className:"w-5 h-5 text-green-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Total Ingresos"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.summary.total_revenue_formatted})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(x,{className:"w-5 h-5 text-yellow-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Promedio por Vendedora"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.summary.average_sales_per_seller_formatted})]})]}),t.top_sellers&&t.top_sellers.length>=3&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Podio de Vendedoras"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-gradient-to-br from-yellow-100 to-yellow-50 rounded-lg p-6 border-2 border-yellow-400",children:[a.jsx("div",{className:"text-center mb-4",children:a.jsx("span",{className:"text-5xl",children:"游볞"})}),a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"font-bold text-gray-900 mb-2",children:t.top_sellers[0].seller_name}),a.jsx("div",{className:"text-2xl font-bold text-yellow-600 mb-2",children:t.top_sellers[0].total_sales_formatted}),a.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[a.jsxs("div",{children:[t.top_sellers[0].invoice_count," facturas"]}),a.jsxs("div",{children:["Ticket: ",t.top_sellers[0].average_ticket_formatted]}),a.jsxs("div",{className:"text-xs text-gray-600",children:["Hora productiva: ",t.top_sellers[0].most_productive_hour]})]})]})]}),a.jsxs("div",{className:"bg-gradient-to-br from-gray-200 to-gray-50 rounded-lg p-6 border-2 border-gray-400",children:[a.jsx("div",{className:"text-center mb-4",children:a.jsx("span",{className:"text-5xl",children:"游볟"})}),a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"font-bold text-gray-900 mb-2",children:t.top_sellers[1].seller_name}),a.jsx("div",{className:"text-2xl font-bold text-gray-600 mb-2",children:t.top_sellers[1].total_sales_formatted}),a.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[a.jsxs("div",{children:[t.top_sellers[1].invoice_count," facturas"]}),a.jsxs("div",{children:["Ticket: ",t.top_sellers[1].average_ticket_formatted]}),a.jsxs("div",{className:"text-xs text-gray-600",children:["Hora productiva: ",t.top_sellers[1].most_productive_hour]})]})]})]}),a.jsxs("div",{className:"bg-gradient-to-br from-orange-100 to-orange-50 rounded-lg p-6 border-2 border-orange-400",children:[a.jsx("div",{className:"text-center mb-4",children:a.jsx("span",{className:"text-5xl",children:"游볠"})}),a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"font-bold text-gray-900 mb-2",children:t.top_sellers[2].seller_name}),a.jsx("div",{className:"text-2xl font-bold text-orange-600 mb-2",children:t.top_sellers[2].total_sales_formatted}),a.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[a.jsxs("div",{children:[t.top_sellers[2].invoice_count," facturas"]}),a.jsxs("div",{children:["Ticket: ",t.top_sellers[2].average_ticket_formatted]}),a.jsxs("div",{className:"text-xs text-gray-600",children:["Hora productiva: ",t.top_sellers[2].most_productive_hour]})]})]})]})]})]}),t.top_sellers&&t.top_sellers.length>0&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b border-gray-200",children:a.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Ranking Completo"})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Rank"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Vendedora"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Ventas"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Facturas"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ticket Prom."}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Clientes 칔nicos"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Hora Productiva"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.top_sellers.map((e,s)=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("span",{className:"font-bold "+(0===s?"text-yellow-600":1===s?"text-gray-400":2===s?"text-orange-600":"text-gray-600"),children:["#",s+1]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.seller_name})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"text-sm font-semibold text-green-600",children:e.total_sales_formatted})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.invoice_count}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.average_ticket_formatted}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.unique_customers}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.most_productive_hour})]},e.seller_id))})]})})]})]}):null},C=()=>{var t;const[l,i]=r.useState(null),[o,x]=r.useState(!1),[m,h]=r.useState(null),[p,g]=r.useState({start_date:"",end_date:""}),u=async()=>{if(p.start_date&&p.end_date){x(!0),h(null);try{const a=await(async(a={})=>{try{const t=new URLSearchParams;a.date&&t.append("date",a.date),a.start_date&&t.append("start_date",a.start_date),a.end_date&&t.append("end_date",a.end_date);const r=t.toString(),l="/api/analytics/customer-retention"+(r?`?${r}`:"");e.info("Obteniendo retenci칩n de clientes:",a);const d=await s(l,{method:"GET"},v);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener retenci칩n de clientes")}return await d.json()}catch(m){throw e.error("Error en getCustomerRetention:",m),m}})(p);a.success?i(a.data):h(a.error||"Error al cargar datos")}catch(a){h(a.message||"Error al conectar con el servidor")}finally{x(!1)}}else h("Por favor selecciona ambas fechas para consultar")};return o?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(d,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Cargando retenci칩n de clientes..."})]})}):m?a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[a.jsx(n,{className:"w-6 h-6"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),a.jsx("p",{className:"text-sm",children:m})]})]}),a.jsx("button",{onClick:u,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):l?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),a.jsx("input",{type:"date",value:p.start_date,onChange:e=>g(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),a.jsx("span",{className:"text-gray-600",children:"hasta"}),a.jsx("input",{type:"date",value:p.end_date,onChange:e=>g(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})}),l.summary&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Segmentaci칩n de Clientes"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-green-50 border-2 border-green-300 rounded-lg p-6 text-center",children:[a.jsx("h4",{className:"text-lg font-semibold text-green-800 mb-2",children:"Nuevos"}),a.jsx("div",{className:"text-4xl font-bold text-green-600 mb-2",children:l.summary.new_customers}),a.jsx("p",{className:"text-sm text-green-700",children:"1 compra"})]}),a.jsxs("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6 text-center",children:[a.jsx("h4",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Recurrentes"}),a.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:l.summary.recurring_customers}),a.jsx("p",{className:"text-sm text-blue-700",children:"2-4 compras"})]}),a.jsxs("div",{className:"bg-purple-50 border-2 border-purple-300 rounded-lg p-6 text-center",children:[a.jsx("h4",{className:"text-lg font-semibold text-purple-800 mb-2",children:"Leales"}),a.jsx("div",{className:"text-4xl font-bold text-purple-600 mb-2",children:l.summary.loyal_customers}),a.jsx("p",{className:"text-sm text-purple-700",children:"5+ compras"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-lg",children:[a.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-semibold text-gray-900",children:"Activos"}),a.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.summary.active_customers})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 rounded-lg",children:[a.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded-full"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-semibold text-gray-900",children:"En Riesgo"}),a.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:l.summary.at_risk_customers})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 rounded-lg",children:[a.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-semibold text-gray-900",children:"Inactivos"}),a.jsx("div",{className:"text-2xl font-bold text-red-600",children:l.summary.inactive_customers})]})]})]}),a.jsxs("div",{className:"mt-6 text-center",children:[a.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Tasa de Retenci칩n"}),a.jsxs("div",{className:"text-5xl font-bold text-purple-600",children:[null==(t=l.summary.retention_rate)?void 0:t.toFixed(1),"%"]})]})]}),l.top_loyal_customers&&l.top_loyal_customers.length>0&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b border-gray-200",children:a.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Top Clientes Leales"})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Frecuencia"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Gastado"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"칔ltima Compra"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.top_loyal_customers.slice(0,10).map(e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.customer_name})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.frequency," compras"]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"text-sm font-semibold text-green-600",children:e.monetary_formatted})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.last_purchase_date}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full "+("Activo"===e.activity_status?"bg-green-100 text-green-800":"En riesgo"===e.activity_status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.activity_status})})]},e.customer_id))})]})})]}),l.at_risk_customers&&l.at_risk_customers.length>0&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b border-gray-200",children:a.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(n,{className:"w-5 h-5 text-yellow-600"}),"Clientes en Riesgo"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"D칤as Sin Comprar"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Gastado"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"칔ltima Compra"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.at_risk_customers.slice(0,10).map(e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.customer_name})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("span",{className:"text-sm font-semibold text-yellow-600",children:[e.recency_days," d칤as"]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.monetary_formatted}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.last_purchase_date})]},e.customer_id))})]})})]})]}):null},S=()=>{var t,l,i,o,x,m;const[p,u]=r.useState(null),[j,b]=r.useState(!1),[y,N]=r.useState(null),[f,_]=r.useState({start_date:"",end_date:""}),w=async()=>{if(f.start_date&&f.end_date){b(!0),N(null);try{const a=await(async(a={})=>{try{const t=new URLSearchParams;a.date&&t.append("date",a.date),a.start_date&&t.append("start_date",a.start_date),a.end_date&&t.append("end_date",a.end_date);const r=t.toString(),l="/api/analytics/sales-trends"+(r?`?${r}`:"");e.info("Obteniendo tendencias de ventas:",a);const d=await s(l,{method:"GET"},v);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener tendencias de ventas")}return await d.json()}catch(y){throw e.error("Error en getSalesTrends:",y),y}})(f);a.success?u(a.data):N(a.error||"Error al cargar datos")}catch(a){N(a.message||"Error al conectar con el servidor")}finally{b(!1)}}else N("Por favor selecciona ambas fechas para consultar")};return j?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(d,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Cargando tendencias..."})]})}):y?a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[a.jsx(n,{className:"w-6 h-6"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),a.jsx("p",{className:"text-sm",children:y})]})]}),a.jsx("button",{onClick:w,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):p?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),a.jsx("input",{type:"date",value:f.start_date,onChange:e=>_(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),a.jsx("span",{className:"text-gray-600",children:"hasta"}),a.jsx("input",{type:"date",value:f.end_date,onChange:e=>_(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})}),p.summary&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(g,{className:"w-5 h-5 text-green-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Total Per칤odo"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:p.summary.total_revenue_formatted})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(h,{className:"w-5 h-5 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Promedio Diario"})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:p.summary.avg_revenue_per_day_formatted})]}),a.jsxs("div",{className:"bg-green-50 border-2 border-green-300 rounded-lg p-6",children:[a.jsx("div",{className:"text-sm text-green-700 mb-2",children:"Mejor D칤a"}),a.jsx("div",{className:"font-semibold text-green-900",children:null==(t=p.summary.best_day)?void 0:t.day_name}),a.jsx("div",{className:"text-xl font-bold text-green-600",children:null==(l=p.summary.best_day)?void 0:l.total_revenue_formatted}),a.jsx("div",{className:"text-xs text-green-700 mt-1",children:null==(i=p.summary.best_day)?void 0:i.date})]}),a.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-6",children:[a.jsx("div",{className:"text-sm text-red-700 mb-2",children:"Peor D칤a"}),a.jsx("div",{className:"font-semibold text-red-900",children:null==(o=p.summary.worst_day)?void 0:o.day_name}),a.jsx("div",{className:"text-xl font-bold text-red-600",children:null==(x=p.summary.worst_day)?void 0:x.total_revenue_formatted}),a.jsx("div",{className:"text-xs text-red-700 mt-1",children:null==(m=p.summary.worst_day)?void 0:m.date})]})]}),p.weekday_analysis&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"An치lisis por D칤a de la Semana"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-2",children:p.weekday_analysis.map(e=>a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[a.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:e.day_name}),a.jsx("div",{className:"text-lg font-bold text-blue-600 mb-1",children:e.avg_revenue_per_day_formatted}),a.jsxs("div",{className:"text-xs text-gray-600",children:[e.invoice_count," facturas"]}),a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.days_count," d칤as"]})]},e.day_name))})]}),p.daily_sales&&p.daily_sales.length>0&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b border-gray-200",children:a.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Ventas Diarias"})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"D칤a"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Facturas"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ticket Prom."})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.daily_sales.map(e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.date}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.day_name}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"text-sm font-semibold text-green-600",children:e.total_revenue_formatted})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.invoice_count}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.average_ticket_formatted})]},e.date))})]})})]})]}):null},E=()=>{const[t,l]=r.useState(null),[i,o]=r.useState(!1),[x,m]=r.useState(null),[h,u]=r.useState(2),[j,b]=r.useState({start_date:"",end_date:""}),y=async()=>{if(j.start_date&&j.end_date){o(!0),m(null);try{const a=await(async(a={})=>{try{const t=new URLSearchParams;a.date&&t.append("date",a.date),a.start_date&&t.append("start_date",a.start_date),a.end_date&&t.append("end_date",a.end_date),a.min_support&&t.append("min_support",a.min_support.toString());const r=t.toString(),l="/api/analytics/cross-selling"+(r?`?${r}`:"");e.info("Obteniendo cross-selling:",a);const d=await s(l,{method:"GET"},v);if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(e.error||"Error al obtener cross-selling")}return await d.json()}catch(x){throw e.error("Error en getCrossSelling:",x),x}})({...j,min_support:h});a.success?l(a.data):m(a.error||"Error al cargar datos")}catch(a){m(a.message||"Error al conectar con el servidor")}finally{o(!1)}}else m("Por favor selecciona ambas fechas para consultar")};return i?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(d,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Cargando an치lisis de cross-selling..."})]})}):x?a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[a.jsx(n,{className:"w-6 h-6"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Error al cargar datos"}),a.jsx("p",{className:"text-sm",children:x})]})]}),a.jsx("button",{onClick:y,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):t?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(c,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"font-semibold text-gray-700",children:"Rango de Fechas:"})]}),a.jsx("input",{type:"date",value:j.start_date,onChange:e=>b(s=>({...s,start_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),a.jsx("span",{className:"text-gray-600",children:"hasta"}),a.jsx("input",{type:"date",value:j.end_date,onChange:e=>b(s=>({...s,end_date:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:"text-sm text-gray-700",children:"Soporte m칤nimo:"}),a.jsx("input",{type:"number",min:"1",max:"10",value:h,onChange:e=>u(Number(e.target.value)),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),t.summary&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Resumen"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg",children:[a.jsx(p,{className:"w-8 h-8 text-blue-600"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Combos Encontrados"}),a.jsx("div",{className:"text-3xl font-bold text-blue-600",children:t.summary.total_product_pairs})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-lg",children:[a.jsx(g,{className:"w-8 h-8 text-purple-600"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Productos 칔nicos"}),a.jsx("div",{className:"text-3xl font-bold text-purple-600",children:t.summary.total_unique_products})]})]})]})]}),t.top_product_pairs&&t.top_product_pairs.length>0&&a.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Top Productos que se Compran Juntos"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.top_product_pairs.map((e,s)=>{var t;return a.jsxs("div",{className:"border-2 border-gray-200 rounded-lg p-4 hover:border-blue-400 transition-colors",children:[a.jsx("div",{className:"text-center mb-3",children:a.jsxs("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-800 font-semibold rounded-full text-sm",children:["#",s+1]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",title:e.product1,children:e.product1}),a.jsx("div",{className:"text-center text-2xl font-bold text-gray-400",children:"+"}),a.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",title:e.product2,children:e.product2})]}),a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-xs text-gray-600",children:"Comprados juntos:"}),a.jsxs("span",{className:"font-semibold text-blue-600",children:[e.times_bought_together," veces"]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-xs text-gray-600",children:"Ingresos:"}),a.jsx("span",{className:"font-semibold text-green-600",children:e.total_revenue_formatted})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-xs text-gray-600",children:"Confianza:"}),a.jsxs("span",{className:"font-semibold text-purple-600",children:[null==(t=e.avg_confidence)?void 0:t.toFixed(1),"%"]})]})]})]},s)})})]}),t.top_product_pairs&&t.top_product_pairs.length>0&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Sugerencia:"})," Estos pares de productos se compran frecuentemente juntos. Considera crear combos o promociones para incrementar las ventas."]})}),t.top_product_pairs&&0===t.top_product_pairs.length&&a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center",children:a.jsxs("p",{className:"text-yellow-800",children:["No se encontraron pares de productos con el soporte m칤nimo de ",h,". Intenta reducir el soporte m칤nimo o ampliar el rango de fechas."]})})]}):null},T=()=>{const e=l(),[s,d]=r.useState("dashboard");t((()=>{switch(s){case"dashboard":return"Analytics - Dashboard Completo";case"peak-hours":return"Analytics - Horas Pico";case"top-customers":return"Analytics - Top Clientes";case"top-sellers":return"Analytics - Top Vendedoras";case"retention":return"Analytics - Retenci칩n de Clientes";case"trends":return"Analytics - Tendencias de Ventas";case"cross-selling":return"Analytics - Cross-Selling";default:return"Analytics Avanzado"}})());const n=[{id:"dashboard",label:"Dashboard Completo",icon:N,description:"Vista unificada de KPIs"},{id:"peak-hours",label:"Horas Pico",icon:i,description:"Mejores horas de venta"},{id:"top-customers",label:"Top Clientes",icon:o,description:"Clientes que m치s compran"},{id:"top-sellers",label:"Top Vendedoras",icon:x,description:"Vendedoras destacadas"},{id:"retention",label:"Retenci칩n",icon:m,description:"An치lisis RFM"},{id:"trends",label:"Tendencias",icon:h,description:"Patrones de venta"},{id:"cross-selling",label:"Cross-Selling",icon:p,description:"Productos relacionados"}];return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:[a.jsx("div",{className:"bg-white shadow-md border-b border-gray-200",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>{e("/dashboard")},className:"p-2 hover:bg-gray-100 rounded-lg transition-all",title:"Volver al Dashboard",children:a.jsx(b,{className:"w-6 h-6 text-gray-600"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(y,{className:"w-7 h-7 text-blue-600"}),"Analytics Avanzado"]}),a.jsx("p",{className:"text-sm text-gray-600",children:"An치lisis inteligente de ventas"})]})]})})})}),a.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4",children:a.jsx("div",{className:"flex gap-2 overflow-x-auto py-2",children:n.map(e=>{const t=e.icon,r=s===e.id;return a.jsxs("button",{onClick:()=>d(e.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg whitespace-nowrap transition-all "+(r?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[a.jsx(t,{className:"w-4 h-4 "+(r?"text-white":"text-gray-600")}),a.jsxs("div",{className:"text-left",children:[a.jsx("div",{className:"text-sm font-semibold "+(r?"text-white":"text-gray-900"),children:e.label}),a.jsx("div",{className:"text-xs "+(r?"text-blue-100":"text-gray-500"),children:e.description})]})]},e.id)})})})}),a.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:(()=>{switch(s){case"dashboard":default:return a.jsx(f,{});case"peak-hours":return a.jsx(_,{});case"top-customers":return a.jsx(w,{});case"top-sellers":return a.jsx(k,{});case"retention":return a.jsx(C,{});case"trends":return a.jsx(S,{});case"cross-selling":return a.jsx(E,{})}})()})]})};export{T as default};
