import{l as e,j as t}from"./index-cGXevk3w.js";import{r as s,u as a}from"./react-vendor-BQCAaWH2.js";import{g as r}from"./dateUtils-DNdQ6mri.js";import{d as l,A as n,R as d,g as o,T as i,b as c,D as m,F as x,c as h}from"./icons-D9BTODEp.js";const p=["http://10.28.168.57:5000","http://localhost:5000"],u="https://cierre-caja-api.onrender.com",g=(t=null,a=null)=>{const[r,l]=s.useState(null),[n,d]=s.useState(!0),[o,i]=s.useState(null),c=async()=>{try{d(!0),i(null);const r=new URLSearchParams;t&&r.append("start_date",t),a&&r.append("end_date",a);const n="/api/monthly_sales"+(r.toString()?"?"+r.toString():"");e.info("Intentando obtener ventas mensuales:",n);const o=(()=>{const e=window.location.hostname;return!["onrender.com","netlify.app","vercel.app","github.io","herokuapp.com","railway.app","fly.dev"].some(t=>e.endsWith(t)||e.includes(t))&&("localhost"===e||"127.0.0.1"===e||e.startsWith("192.168.")||e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("172.17.")||e.startsWith("172.18.")||e.startsWith("172.19.")||e.startsWith("172.2")||e.startsWith("172.30.")||e.startsWith("172.31."))})();let c=null,m=null;if(o){e.info("Frontend en entorno LOCAL - Prioridad: backends locales");for(const t of p)try{const s=`${t}${n}`;if(e.info("Intentando con:",s),c=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}}),c.ok){e.info("Conectado exitosamente con:",t);break}}catch(s){e.warn(`Error con ${t}:`,s.message),m=s}if(!c||!c.ok){e.warn("Backends locales no disponibles, intentando con backend desplegado como fallback...");try{const t=`${u}${n}`;e.info("Intentando con backend desplegado:",t),c=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}})}catch(s){throw e.error("Error con backend desplegado:",s.message),new Error("No se pudo conectar con ningún servidor")}}}else{e.info("Frontend en entorno DESPLEGADO - Usando solo backend desplegado");try{const t=`${u}${n}`;e.info("Conectando con backend desplegado:",t),c=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}})}catch(s){throw e.error("Error con backend desplegado:",s.message),new Error("No se pudo conectar con el servidor")}}const x=await c.json();if(!c.ok)throw new Error(x.error||"Error al obtener ventas mensuales");l(x)}catch(s){i(s.message)}finally{d(!1)}};s.useEffect(()=>{c()},[t,a]);return{data:r,loading:n,error:o,refetch:()=>{c()}}},b=()=>{const e=a(),p=r(),u=p.substring(0,8)+"01",[b,f]=s.useState(u),[j,N]=s.useState(p),{data:y,loading:v,error:w,refetch:_}=g(b,j),k=(e,t)=>0===t?"0.0":(e/t*100).toFixed(1),C=()=>{e("/dashboard")};if(v)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",children:t.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-lg",children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx(l,{className:"w-12 h-12 text-blue-600 animate-spin"}),t.jsx("p",{className:"text-gray-600 font-medium",children:"Cargando ventas mensuales..."}),t.jsx("p",{className:"text-sm text-gray-500",children:"Esto puede tomar unos segundos"})]})})});if(w)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4",children:t.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-lg max-w-md w-full",children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:t.jsx(n,{className:"w-10 h-10 text-red-600"})}),t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Error al cargar datos"}),t.jsx("p",{className:"text-gray-600 text-center",children:w}),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsxs("button",{onClick:_,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all flex items-center gap-2",children:[t.jsx(d,{className:"w-4 h-4"}),"Reintentar"]}),t.jsx("button",{onClick:C,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all",children:"Volver"})]})]})})});if(!y)return null;const E=(F=y.total_vendido.total,0===($=y.cantidad_facturas)?0:F/$);var F,$,S;return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 py-8 px-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:C,className:"p-2 hover:bg-white rounded-lg transition-all",title:"Volver al Dashboard",children:t.jsx(o,{className:"w-6 h-6 text-gray-600"})}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(i,{className:"w-8 h-8 text-blue-600"}),"Ventas Mensuales"]}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Consulta de ventas desde Alegra"})]})]}),t.jsxs("button",{onClick:_,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all shadow-md",children:[t.jsx(d,{className:"w-4 h-4"}),"Actualizar"]})]}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx(c,{className:"w-5 h-5 text-purple-600"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Seleccionar Periodo"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Inicio"}),t.jsx("input",{type:"date",value:b,onChange:e=>f(e.target.value),max:j,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Fin"}),t.jsx("input",{type:"date",value:j,onChange:e=>N(e.target.value),min:b,max:p,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),t.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:t.jsxs("p",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Periodo seleccionado:"})," ",y.date_range.start," al ",y.date_range.end]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl shadow-lg p-6 text-white",children:[t.jsx("div",{className:"flex items-center justify-between mb-3",children:t.jsx(m,{className:"w-8 h-8 opacity-80"})}),t.jsx("h3",{className:"text-sm font-medium opacity-90 mb-1",children:"Total Vendido"}),t.jsx("p",{className:"text-3xl font-bold mb-2",children:y.total_vendido.formatted}),t.jsxs("p",{className:"text-xs opacity-75",children:[y.date_range.start," - ",y.date_range.end]})]}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-gray-100",children:[t.jsx("div",{className:"flex items-center justify-between mb-3",children:t.jsx(x,{className:"w-8 h-8 text-green-600"})}),t.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Facturas Generadas"}),t.jsx("p",{className:"text-3xl font-bold text-gray-900 mb-2",children:y.cantidad_facturas}),t.jsx("p",{className:"text-xs text-gray-500",children:"Facturas en el periodo"})]}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-gray-100",children:[t.jsx("div",{className:"flex items-center justify-between mb-3",children:t.jsx(i,{className:"w-8 h-8 text-orange-600"})}),t.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Promedio por Factura"}),t.jsx("p",{className:"text-3xl font-bold text-gray-900 mb-2",children:(S=E,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(S))}),t.jsx("p",{className:"text-xs text-gray-500",children:"Venta promedio"})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[t.jsx(h,{className:"w-5 h-5 text-indigo-600"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Desglose por Método de Pago"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border border-green-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"text-sm font-semibold text-green-900",children:y.payment_methods.cash.label}),t.jsxs("span",{className:"text-xs font-bold text-green-700 bg-green-200 px-2 py-1 rounded",children:[k(y.payment_methods.cash.total,y.total_vendido.total),"%"]})]}),t.jsx("p",{className:"text-2xl font-bold text-green-700 mb-1",children:y.payment_methods.cash.formatted}),t.jsx("div",{className:"w-full bg-green-200 rounded-full h-2",children:t.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${k(y.payment_methods.cash.total,y.total_vendido.total)}%`}})})]}),t.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"text-sm font-semibold text-purple-900",children:y.payment_methods.transfer.label}),t.jsxs("span",{className:"text-xs font-bold text-purple-700 bg-purple-200 px-2 py-1 rounded",children:[k(y.payment_methods.transfer.total,y.total_vendido.total),"%"]})]}),t.jsx("p",{className:"text-2xl font-bold text-purple-700 mb-1",children:y.payment_methods.transfer.formatted}),t.jsx("div",{className:"w-full bg-purple-200 rounded-full h-2",children:t.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${k(y.payment_methods.transfer.total,y.total_vendido.total)}%`}})})]}),t.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"text-sm font-semibold text-blue-900",children:y.payment_methods["credit-card"].label}),t.jsxs("span",{className:"text-xs font-bold text-blue-700 bg-blue-200 px-2 py-1 rounded",children:[k(y.payment_methods["credit-card"].total,y.total_vendido.total),"%"]})]}),t.jsx("p",{className:"text-2xl font-bold text-blue-700 mb-1",children:y.payment_methods["credit-card"].formatted}),t.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:t.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${k(y.payment_methods["credit-card"].total,y.total_vendido.total)}%`}})})]}),t.jsxs("div",{className:"bg-orange-50 rounded-xl p-4 border border-orange-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"text-sm font-semibold text-orange-900",children:y.payment_methods["debit-card"].label}),t.jsxs("span",{className:"text-xs font-bold text-orange-700 bg-orange-200 px-2 py-1 rounded",children:[k(y.payment_methods["debit-card"].total,y.total_vendido.total),"%"]})]}),t.jsx("p",{className:"text-2xl font-bold text-orange-700 mb-1",children:y.payment_methods["debit-card"].formatted}),t.jsx("div",{className:"w-full bg-orange-200 rounded-full h-2",children:t.jsx("div",{className:"bg-orange-600 h-2 rounded-full",style:{width:`${k(y.payment_methods["debit-card"].total,y.total_vendido.total)}%`}})})]})]})]}),t.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl",children:t.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Usuario Alegra:"})," ",y.username_used]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Timestamp del servidor:"})," ",y.server_timestamp]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Zona horaria:"})," ",y.timezone]})]})})]})})};export{b as default};
