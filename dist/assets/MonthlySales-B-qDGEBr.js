import{l as e,c as s,a as t,g as a,j as l}from"./index-B8WEInyD.js";import{r,u as d}from"./react-vendor-CfGu_lG-.js";import{I as n,V as o,a as i}from"./VoidedInvoicesModal-D9di2XDS.js";import{A as c,R as m,X as x,i as h,T as u,c as b,f as g,j as p,D as j,F as f,d as N}from"./icons-CayQ0oIs.js";const v=(t=null,a=null)=>{const[l,d]=r.useState(null),[n,o]=r.useState(!1),[i,c]=r.useState(null);return{data:l,loading:n,error:i,refetch:()=>{(async()=>{try{o(!0),c(null);const l=new URLSearchParams;t&&l.append("start_date",t),a&&l.append("end_date",a);const r="/api/monthly_sales"+(l.toString()?"?"+l.toString():"");e.info("Intentando obtener ventas mensuales:",r);const n=18e4,i=await s(r,{method:"GET"},n);if(!i.ok){const e=await i.json();throw new Error(e.error||e.message||"Error al obtener ventas mensuales")}const m=await i.json();e.info("Ventas mensuales obtenidas exitosamente:",m),d(m)}catch(l){c(l.message)}finally{o(!1)}})()}}},y=()=>{const e=d();t("Ventas Mensuales");const s=a(),y=s.substring(0,8)+"01",[w,_]=r.useState(y),[S,C]=r.useState(s),[F,V]=r.useState(null),[P,k]=r.useState(!1),{data:E,loading:I,error:T,refetch:$}=v(w,S),D=(e,s)=>0===s?"0.0":(e/s*100).toFixed(1),A=()=>{e("/dashboard")};return T?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4",children:l.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-lg max-w-md w-full",children:l.jsxs("div",{className:"flex flex-col items-center gap-4",children:[l.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:l.jsx(c,{className:"w-10 h-10 text-red-600"})}),l.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Error al cargar datos"}),l.jsx("p",{className:"text-gray-600 text-center",children:T}),l.jsxs("div",{className:"flex gap-3 mt-4",children:[l.jsxs("button",{onClick:$,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all flex items-center gap-2",children:[l.jsx(m,{className:"w-4 h-4"}),"Reintentar"]}),l.jsx("button",{onClick:A,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all",children:"Volver"})]})]})})}):l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 py-8 px-4",children:[F&&l.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 w-11/12 max-w-md animate-slide-down",children:l.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 rounded-lg shadow-lg p-4 flex items-start gap-3",children:[l.jsx(c,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-sm font-semibold text-yellow-900",children:"Validación"}),l.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:F})]}),l.jsx("button",{onClick:()=>V(null),className:"text-yellow-600 hover:text-yellow-800 transition-colors",children:l.jsx(x,{className:"w-5 h-5"})})]})}),l.jsxs("div",{className:"max-w-7xl mx-auto",children:[l.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:A,className:"p-2 hover:bg-white rounded-lg transition-all",title:"Volver al Dashboard",children:l.jsx(h,{className:"w-6 h-6 text-gray-600"})}),l.jsxs("div",{children:[l.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[l.jsx(u,{className:"w-8 h-8 text-blue-600"}),"Ventas Mensuales"]}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Consulta de ventas desde Alegra"})]})]})}),l.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(b,{className:"w-5 h-5 text-purple-600"}),l.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Seleccionar Periodo"})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Inicio"}),l.jsx("input",{type:"date",value:w,onChange:e=>{const t=e.target.value;t>s?(V("No se pueden seleccionar fechas futuras. Se ha establecido la fecha de hoy como fecha de inicio."),_(s),setTimeout(()=>V(null),5e3)):_(t)},max:S,disabled:I,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Fin"}),l.jsx("input",{type:"date",value:S,onChange:e=>{const t=e.target.value;t>s?(V("No se pueden seleccionar fechas futuras. Se ha establecido la fecha de hoy."),C(s),setTimeout(()=>V(null),5e3)):C(t)},min:w,max:s,disabled:I,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]})]}),l.jsx("div",{className:"flex justify-center mt-4",children:l.jsx("button",{onClick:$,disabled:I,className:"flex items-center justify-center gap-2 px-8 py-2.5 rounded-xl transition-all shadow-md "+(I?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white"),children:I?l.jsxs(l.Fragment,{children:[l.jsx(g,{className:"w-5 h-5 animate-spin"}),"Consultando..."]}):l.jsxs(l.Fragment,{children:[l.jsx(p,{className:"w-5 h-5"}),"Consultar Período"]})})}),E&&E.date_range&&l.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:l.jsxs("p",{className:"text-sm text-blue-800",children:[l.jsx("strong",{children:"Periodo consultado:"})," ",E.date_range.start," al ",E.date_range.end]})})]}),I&&l.jsx("div",{className:"flex items-center justify-center py-12",children:l.jsx("div",{className:"bg-white rounded-2xl p-8 shadow-lg max-w-md",children:l.jsxs("div",{className:"flex flex-col items-center gap-4",children:[l.jsx(g,{className:"w-12 h-12 text-blue-600 animate-spin"}),l.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:"Procesando facturas..."}),l.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Estamos consultando todas las facturas del periodo en Alegra."}),l.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-2",children:l.jsxs("p",{className:"text-sm text-yellow-800 text-center",children:["⏱️ ",l.jsx("strong",{children:"Este proceso puede tardar 1-3 minutos"})," dependiendo de la cantidad de facturas."]})}),l.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Por favor no cierres esta ventana"})]})})}),!I&&!E&&l.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-8 text-center",children:[l.jsx(u,{className:"w-16 h-16 text-blue-400 mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Selecciona un período para consultar"}),l.jsx("p",{className:"text-sm text-blue-700",children:'Elige las fechas y presiona "Consultar Período" para ver las ventas mensuales'})]}),!I&&E&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[l.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl shadow-lg p-6 text-white",children:[l.jsx("div",{className:"flex items-center justify-between mb-3",children:l.jsx(j,{className:"w-8 h-8 opacity-80"})}),l.jsx("h3",{className:"text-sm font-medium opacity-90 mb-1",children:"Total Vendido"}),l.jsx("p",{className:"text-3xl font-bold mb-2",children:E.total_vendido.formatted}),l.jsxs("p",{className:"text-xs opacity-75",children:[E.date_range.start," - ",E.date_range.end]})]}),l.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-gray-100",children:[l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsx(f,{className:"w-8 h-8 text-green-600"}),E.invoices_summary&&l.jsx(n,{invoicesSummary:E.invoices_summary,variant:"compact"})]}),l.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Facturas Generadas"}),l.jsx("p",{className:"text-3xl font-bold text-gray-900 mb-2",children:E.cantidad_facturas}),l.jsx("p",{className:"text-xs text-gray-500",children:E.invoices_summary?`${E.invoices_summary.active_invoices} activas de ${E.invoices_summary.total_invoices} recibidas`:"Facturas en el periodo"})]}),l.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-gray-100",children:[l.jsx("div",{className:"flex items-center justify-between mb-3",children:l.jsx(u,{className:"w-8 h-8 text-orange-600"})}),l.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-1",children:"Promedio por Factura"}),l.jsx("p",{className:"text-3xl font-bold text-gray-900 mb-2",children:(O=E.total_vendido.total,R=E.cantidad_facturas,M=0===R?0:O/R,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(M))}),l.jsx("p",{className:"text-xs text-gray-500",children:"Venta promedio"})]})]}),E.voided_invoices&&l.jsx("div",{className:"mb-6",children:l.jsx(o,{voidedInvoices:E.voided_invoices,onViewDetails:()=>k(!0)})}),l.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[l.jsx(N,{className:"w-5 h-5 text-indigo-600"}),l.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Desglose por Método de Pago"})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border border-green-100",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("h3",{className:"text-sm font-semibold text-green-900",children:E.payment_methods.cash.label}),l.jsxs("span",{className:"text-xs font-bold text-green-700 bg-green-200 px-2 py-1 rounded",children:[D(E.payment_methods.cash.total,E.total_vendido.total),"%"]})]}),l.jsx("p",{className:"text-2xl font-bold text-green-700 mb-1",children:E.payment_methods.cash.formatted}),l.jsx("div",{className:"w-full bg-green-200 rounded-full h-2",children:l.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${D(E.payment_methods.cash.total,E.total_vendido.total)}%`}})})]}),l.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-100",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("h3",{className:"text-sm font-semibold text-purple-900",children:E.payment_methods.transfer.label}),l.jsxs("span",{className:"text-xs font-bold text-purple-700 bg-purple-200 px-2 py-1 rounded",children:[D(E.payment_methods.transfer.total,E.total_vendido.total),"%"]})]}),l.jsx("p",{className:"text-2xl font-bold text-purple-700 mb-1",children:E.payment_methods.transfer.formatted}),l.jsx("div",{className:"w-full bg-purple-200 rounded-full h-2",children:l.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${D(E.payment_methods.transfer.total,E.total_vendido.total)}%`}})})]}),l.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-100",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("h3",{className:"text-sm font-semibold text-blue-900",children:E.payment_methods["credit-card"].label}),l.jsxs("span",{className:"text-xs font-bold text-blue-700 bg-blue-200 px-2 py-1 rounded",children:[D(E.payment_methods["credit-card"].total,E.total_vendido.total),"%"]})]}),l.jsx("p",{className:"text-2xl font-bold text-blue-700 mb-1",children:E.payment_methods["credit-card"].formatted}),l.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:l.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${D(E.payment_methods["credit-card"].total,E.total_vendido.total)}%`}})})]}),l.jsxs("div",{className:"bg-orange-50 rounded-xl p-4 border border-orange-100",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("h3",{className:"text-sm font-semibold text-orange-900",children:E.payment_methods["debit-card"].label}),l.jsxs("span",{className:"text-xs font-bold text-orange-700 bg-orange-200 px-2 py-1 rounded",children:[D(E.payment_methods["debit-card"].total,E.total_vendido.total),"%"]})]}),l.jsx("p",{className:"text-2xl font-bold text-orange-700 mb-1",children:E.payment_methods["debit-card"].formatted}),l.jsx("div",{className:"w-full bg-orange-200 rounded-full h-2",children:l.jsx("div",{className:"bg-orange-600 h-2 rounded-full",style:{width:`${D(E.payment_methods["debit-card"].total,E.total_vendido.total)}%`}})})]})]})]}),l.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl",children:l.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[l.jsxs("p",{children:[l.jsx("strong",{children:"Usuario Alegra:"})," ",E.username_used]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Timestamp del servidor:"})," ",E.server_timestamp]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Zona horaria:"})," ",E.timezone]})]})})]}),E&&E.voided_invoices&&l.jsx(i,{isOpen:P,onClose:()=>k(!1),voidedInvoices:E.voided_invoices})]})]});var M,O,R};export{y as default};
