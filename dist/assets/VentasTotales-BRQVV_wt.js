import{a as e,j as t,l as s}from"./index-BnWi8DhN.js";import{r as a}from"./react-vendor-CfGu_lG-.js";import{D as r}from"./DateRangeFilter-BXr521So.js";import{a as l}from"./directApiService-3aVSKyYn.js";import{T as i,B as n,D as c,F as o,e as d}from"./icons-C1UI5Wwr.js";const x=()=>{e("Totales de Ventas - Estadísticas Avanzadas");const[x,m]=a.useState([]),[h,g]=a.useState(!1),[p,u]=a.useState(""),j=(new Date).toISOString().split("T")[0],y=new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString().split("T")[0],[N,v]=a.useState(y),[b,f]=a.useState(j),[w,S]=a.useState("day"),[D,T]=a.useState(30),[k,F]=a.useState({totalSales:0,totalInvoices:0,averageTicket:0,averageDaily:0}),I=async()=>{g(!0),u("");try{const e=await l(N,b,w,D);if(e.success){const t=e.data.data||[];m(t);const a=t.reduce((e,t)=>e+(t.totalSales||0),0),r=t.reduce((e,t)=>e+(t.totalInvoices||0),0),l=r>0?a/r:0,i=t.length>0?a/t.length:0;F({totalSales:a,totalInvoices:r,averageTicket:l,averageDaily:i}),s.info("Totales de ventas cargados exitosamente",{records:t.length})}else u(e.error||"Error al cargar totales de ventas"),s.error("Error cargando totales:",e.error)}catch(e){u("Error inesperado al cargar totales de ventas"),s.error("Error inesperado:",e)}finally{g(!1)}};a.useEffect(()=>{I()},[]);const E=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e||0),O=e=>{if("month"===w){const[t,s]=e.split("-");return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][parseInt(s)-1]} ${t}`}return new Date(e+"T00:00:00").toLocaleDateString("es-CO",{day:"numeric",month:"short",year:"numeric"})};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl shadow-lg p-6 text-white",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(i,{className:"w-8 h-8"}),t.jsx("h1",{className:"text-3xl font-bold",children:"Totales de Ventas"})]}),t.jsx("p",{className:"text-purple-100",children:"Reporte de ventas agrupadas por día o mes con métricas detalladas"})]}),t.jsxs(r,{fromDate:N,toDate:b,onFromDateChange:v,onToDateChange:f,onSubmit:()=>{I()},loading:h,children:[t.jsxs("div",{className:"min-w-[150px]",children:[t.jsxs("label",{htmlFor:"groupBy",className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(n,{className:"w-4 h-4 inline mr-1"}),"Agrupar por"]}),t.jsxs("select",{id:"groupBy",value:w,onChange:e=>S(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all outline-none",children:[t.jsx("option",{value:"day",children:"Día"}),t.jsx("option",{value:"month",children:"Mes"})]})]}),t.jsxs("div",{className:"min-w-[150px]",children:[t.jsx("label",{htmlFor:"limit",className:"block text-sm font-medium text-gray-700 mb-2",children:"Registros"}),t.jsxs("select",{id:"limit",value:D,onChange:e=>T(Number(e.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all outline-none",children:[t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"30",children:"30"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"100",children:"100"})]})]})]}),p&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-800",children:p}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Ventas"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E(k.totalSales)})]}),t.jsx(c,{className:"w-12 h-12 text-green-500"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Facturas"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:k.totalInvoices.toLocaleString()})]}),t.jsx(o,{className:"w-12 h-12 text-blue-500"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Ticket Promedio"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E(k.averageTicket)})]}),t.jsx(i,{className:"w-12 h-12 text-purple-500"})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Promedio ","day"===w?"Diario":"Mensual"]}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E(k.averageDaily)})]}),t.jsx(d,{className:"w-12 h-12 text-orange-500"})]})})]}),t.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Ventas"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Facturas"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ticket Promedio"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h?t.jsx("tr",{children:t.jsx("td",{colSpan:"4",className:"px-6 py-20 text-center",children:t.jsxs("div",{className:"flex flex-col items-center justify-center",children:[t.jsx("div",{className:"w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Cargando totales de ventas..."})]})})}):0===x.length?t.jsx("tr",{children:t.jsx("td",{colSpan:"4",className:"px-6 py-20 text-center text-gray-500",children:"No se encontraron ventas para el período seleccionado"})}):x.map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(d,{className:"w-4 h-4 text-gray-400 mr-2"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:O(e.date)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-green-600",children:E(e.totalSales)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:(e.totalInvoices||0).toLocaleString()}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:E(e.averageTicket)})]},s))}),!h&&x.length>0&&t.jsx("tfoot",{className:"bg-gray-100 font-bold",children:t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"TOTAL DEL PERÍODO"}),t.jsx("td",{className:"px-6 py-4 text-right text-sm text-green-700",children:E(k.totalSales)}),t.jsx("td",{className:"px-6 py-4 text-right text-sm text-gray-900",children:k.totalInvoices.toLocaleString()}),t.jsx("td",{className:"px-6 py-4 text-right text-sm text-gray-900",children:E(k.averageTicket)})]})})]})})})]})};export{x as default};
