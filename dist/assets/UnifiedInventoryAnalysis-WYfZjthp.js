import{l as e,c as s,j as t,a,g as r}from"./index-BcnWprcg.js";import{r as l}from"./react-vendor-CfGu_lG-.js";import{g as n}from"./directApiService-B7P3JzcJ.js";import{P as i,y as d,A as o,R as c,w as x,D as m,T as h,G as p,n as g,e as b,m as u,z as j,I as N,q as y,J as f,s as v,C as w,K as _,F as C,i as k,M as A,x as S}from"./icons-yh9a4XSz.js";const E=async()=>{const t="/api/inventory/summary";try{e.info("Obteniendo resumen de inventario:",t);const a=await s(t);if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||"Error al obtener resumen de inventario")}const r=await a.json();return e.info("Resumen de inventario obtenido exitosamente"),r}catch(a){throw e.error("Error al obtener resumen de inventario:",a.message),a}},$=async()=>{const t="/api/inventory/by-category";try{e.info("Obteniendo an치lisis por categor칤a:",t);const a=await s(t);if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||"Error al obtener an치lisis por categor칤a")}const r=await a.json();return e.info("An치lisis por categor칤a obtenido exitosamente"),r}catch(a){throw e.error("Error al obtener an치lisis por categor칤a:",a.message),a}},I=async()=>{const t="/api/inventory/by-size";try{e.info("Obteniendo an치lisis por talla:",t);const a=await s(t);if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||"Error al obtener an치lisis por talla")}const r=await a.json();return e.info("An치lisis por talla obtenido exitosamente"),r}catch(a){throw e.error("Error al obtener an치lisis por talla:",a.message),a}},P=async()=>{const t="/api/inventory/out-of-stock";try{e.info("Obteniendo productos sin stock:",t);const a=await s(t);if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||"Error al obtener productos sin stock")}const r=await a.json();return e.info("Productos sin stock obtenidos exitosamente"),r}catch(a){throw e.error("Error al obtener productos sin stock:",a.message),a}},F=async(t=5)=>{const a=`/api/inventory/low-stock?threshold=${t}`;try{e.info("Obteniendo productos con bajo stock:",a);const t=await s(a);if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.error||"Error al obtener productos con bajo stock")}const r=await t.json();return e.info("Productos con bajo stock obtenidos exitosamente"),r}catch(r){throw e.error("Error al obtener productos con bajo stock:",r.message),r}},V=()=>{const[e,s]=l.useState(null),[a,r]=l.useState(null),[n,p]=l.useState(null),[g,b]=l.useState(!1),[u,j]=l.useState(null),N=async()=>{b(!0),j(null);try{const[e,t,a]=await Promise.all([E(),P(),F(5)]);s(e.summary),r(t),p(a)}catch(e){j(e.message)}finally{b(!1)}},y=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),f=e=>e>=20?"text-green-600 bg-green-100":e>=10?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100";return e||g||u?g?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"}),t.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Consultando inventario desde Alegra..."})]})}):u?t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(o,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar inventario"}),t.jsx("p",{className:"text-sm",children:u})]})]}),t.jsxs("button",{onClick:N,className:"mt-4 flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Reintentar"]})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Resumen Ejecutivo"}),t.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Actualizar"]})]}),((null==a?void 0:a.total)>0||(null==n?void 0:n.total)>0)&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(null==a?void 0:a.total)>0&&t.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:t.jsx(o,{className:"w-6 h-6 text-red-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Sin Stock"}),t.jsxs("p",{className:"text-2xl font-bold text-red-700",children:[a.total," productos"]})]})]})}),(null==n?void 0:n.total)>0&&t.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:t.jsx(o,{className:"w-6 h-6 text-yellow-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-yellow-600 font-medium",children:"Bajo Stock"}),t.jsxs("p",{className:"text-2xl font-bold text-yellow-700",children:[n.total," productos"]})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200 hover:shadow-lg transition-shadow",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Total Items"}),t.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:e.total_items}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Con stock: ",e.total_items_con_stock]})]}),t.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:t.jsx(i,{className:"w-8 h-8 text-blue-600"})})]})}),t.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200 hover:shadow-lg transition-shadow",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Total Unidades"}),t.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:e.total_unidades}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"En inventario"})]}),t.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:t.jsx(x,{className:"w-8 h-8 text-purple-600"})})]})}),t.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200 hover:shadow-lg transition-shadow",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Valor Inventario"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:y(e.valor_total_inventario)}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Costo total"})]}),t.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:t.jsx(m,{className:"w-8 h-8 text-green-600"})})]})}),t.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200 hover:shadow-lg transition-shadow",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Margen Esperado"}),t.jsxs("p",{className:`text-3xl font-bold mt-2 ${f(e.porcentaje_margen).split(" ")[0]}`,children:[e.porcentaje_margen.toFixed(1),"%"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:y(e.margen_esperado)})]}),t.jsx("div",{className:`p-3 rounded-lg ${f(e.porcentaje_margen).split(" ")[1]}`,children:t.jsx(h,{className:`w-8 h-8 ${f(e.porcentaje_margen).split(" ")[0]}`})})]})})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Valor de Inventario vs Potencial de Venta"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Valor Inventario (Costo)"}),t.jsx("p",{className:"text-2xl font-bold text-blue-600",children:y(e.valor_total_inventario)}),t.jsx("div",{className:"mt-2 h-2 bg-blue-200 rounded-full",children:t.jsx("div",{className:"h-2 bg-blue-600 rounded-full",style:{width:"100%"}})})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Valor Potencial Venta"}),t.jsx("p",{className:"text-2xl font-bold text-green-600",children:y(e.valor_potencial_venta)}),t.jsx("div",{className:"mt-2 h-2 bg-green-200 rounded-full",children:t.jsx("div",{className:"h-2 bg-green-600 rounded-full",style:{width:e.valor_potencial_venta/e.valor_total_inventario*100+"%"}})})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Ganancia Esperada"}),t.jsx("p",{className:"text-2xl font-bold text-purple-600",children:y(e.margen_esperado)}),t.jsx("div",{className:"mt-2 h-2 bg-purple-200 rounded-full",children:t.jsx("div",{className:"h-2 bg-purple-600 rounded-full",style:{width:`${e.porcentaje_margen}%`}})})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl shadow-md p-6 border border-blue-200",children:[t.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Costo Promedio por Unidad"}),t.jsx("p",{className:"text-3xl font-bold text-blue-700",children:y(e.costo_promedio_por_unidad)})]}),t.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl shadow-md p-6 border border-green-200",children:[t.jsx("h4",{className:"text-sm font-semibold text-green-900 mb-2",children:"Precio Promedio de Venta"}),t.jsx("p",{className:"text-3xl font-bold text-green-700",children:y(e.precio_promedio_venta)})]})]})]}):t.jsx("div",{className:"bg-gradient-to-br from-teal-50 to-blue-50 border-2 border-teal-200 rounded-xl p-12",children:t.jsxs("div",{className:"text-center max-w-2xl mx-auto",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-teal-100 rounded-full mb-6",children:t.jsx(i,{className:"w-10 h-10 text-teal-600"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"An치lisis de Inventario desde Alegra"}),t.jsx("p",{className:"text-gray-600 mb-8",children:"Consulta el inventario actual desde Alegra para ver m칠tricas detalladas, alertas de stock y an치lisis completo."}),t.jsxs("button",{onClick:N,className:"inline-flex items-center gap-3 px-8 py-4 bg-teal-600 text-white rounded-xl hover:bg-teal-700 transition-all shadow-lg hover:shadow-xl text-lg font-semibold",children:[t.jsx(d,{className:"w-6 h-6"}),"Consultar Inventario desde Alegra"]})]})})},O=()=>{const[a,r]=l.useState(null),[n,x]=l.useState(!1),[m,h]=l.useState(null),[u,j]=l.useState(null),N=async()=>{x(!0),h(null);try{const t=await(async()=>{const t="/api/inventory/by-department";try{e.info("Obteniendo an치lisis por departamento:",t);const a=await s(t);if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||"Error al obtener an치lisis por departamento")}const r=await a.json();return e.info("An치lisis por departamento obtenido exitosamente"),r}catch(m){throw e.error("Error al obtener an치lisis por departamento:",m.message),m}})();r(t.data)}catch(t){h(t.message)}finally{x(!1)}},y=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),f=e=>{const s={HOMBRE:{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-700",badge:"bg-blue-100 text-blue-800"},MUJER:{bg:"bg-pink-50",border:"border-pink-200",text:"text-pink-700",badge:"bg-pink-100 text-pink-800"},"NI칌O":{bg:"bg-green-50",border:"border-green-200",text:"text-green-700",badge:"bg-green-100 text-green-800"},"NI칌A":{bg:"bg-purple-50",border:"border-purple-200",text:"text-purple-700",badge:"bg-purple-100 text-purple-800"},UNKNOWN:{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-700",badge:"bg-gray-100 text-gray-800"}};return s[e]||s.UNKNOWN},v=e=>{const s=a?Object.values(a).reduce((e,s)=>e+(s.valor_inventario||0),0):0;return s>0?(e/s*100).toFixed(1):0};if(!a&&!n&&!m)return t.jsx("div",{className:"bg-gradient-to-br from-teal-50 to-blue-50 border-2 border-teal-200 rounded-xl p-12",children:t.jsxs("div",{className:"text-center max-w-2xl mx-auto",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-teal-100 rounded-full mb-6",children:t.jsx(p,{className:"w-10 h-10 text-teal-600"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"An치lisis por Departamento"}),t.jsx("p",{className:"text-gray-600 mb-8",children:"Consulta el an치lisis detallado de inventario agrupado por departamentos desde Alegra."}),t.jsxs("button",{onClick:N,className:"inline-flex items-center gap-3 px-8 py-4 bg-teal-600 text-white rounded-xl hover:bg-teal-700 transition-all shadow-lg hover:shadow-xl text-lg font-semibold",children:[t.jsx(d,{className:"w-6 h-6"}),"Consultar An치lisis por Departamento"]})]})});if(n)return t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"}),t.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Consultando an치lisis por departamento..."})]})});if(m)return t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(o,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar an치lisis"}),t.jsx("p",{className:"text-sm",children:m})]})]}),t.jsxs("button",{onClick:N,className:"mt-4 flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Reintentar"]})]});if(!a||0===Object.keys(a).length)return t.jsx("div",{className:"text-center py-12 text-gray-500",children:"No hay datos de departamentos disponibles"});const w=Object.entries(a);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"An치lisis por Departamento"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Distribuci칩n de inventario por departamento"})]}),t.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Actualizar"]})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Distribuci칩n Total"}),t.jsx("div",{className:"space-y-3",children:w.map(([e,s])=>{const a=f(e),r=v(s.valor_inventario);return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:`font-semibold ${a.text}`,children:e}),t.jsxs("span",{className:"text-sm text-gray-600",children:[r,"%"]})]}),t.jsx("div",{className:"w-full h-4 bg-gray-200 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${a.badge.split(" ")[0]} transition-all`,style:{width:`${r}%`}})}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:y(s.valor_inventario)})]},e)})})]}),t.jsx("div",{className:"grid grid-cols-1 gap-6",children:w.map(([e,s])=>{const a=f(e),r=u===e,l=s.por_categoria&&Object.keys(s.por_categoria).length>0;return t.jsxs("div",{className:`bg-white rounded-xl shadow-md border-2 ${a.border}`,children:[t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-3 ${a.badge} rounded-lg`,children:t.jsx(p,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-xl font-bold ${a.text}`,children:e}),t.jsxs("p",{className:"text-sm text-gray-600",children:[v(s.valor_inventario),"% del inventario total"]})]})]}),l&&t.jsx("button",{onClick:()=>j(r?null:e),className:`p-2 ${a.bg} rounded-lg hover:${a.badge} transition-colors`,children:r?t.jsx(g,{className:"w-5 h-5"}):t.jsx(b,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:`${a.bg} rounded-lg p-4`,children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Items"}),t.jsx("p",{className:`text-2xl font-bold ${a.text}`,children:s.total_items})]}),t.jsxs("div",{className:`${a.bg} rounded-lg p-4`,children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Unidades"}),t.jsx("p",{className:`text-2xl font-bold ${a.text}`,children:s.total_unidades})]}),t.jsxs("div",{className:`${a.bg} rounded-lg p-4`,children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Valor Inventario"}),t.jsx("p",{className:`text-lg font-bold ${a.text}`,children:y(s.valor_inventario)})]}),t.jsxs("div",{className:`${a.bg} rounded-lg p-4`,children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Margen"}),t.jsx("p",{className:`text-lg font-bold ${a.text}`,children:y(s.margen)})]})]}),t.jsx("div",{className:`mt-4 ${a.bg} rounded-lg p-4`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Valor Potencial de Venta"}),t.jsx("p",{className:`text-xl font-bold ${a.text}`,children:y(s.valor_potencial_venta)})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Ganancia Esperada"}),t.jsxs("p",{className:"text-lg font-semibold text-green-600",children:[(s.margen/s.valor_inventario*100).toFixed(1),"%"]})]})]})})]}),r&&l&&t.jsxs("div",{className:`border-t-2 ${a.border} p-6 ${a.bg}`,children:[t.jsxs("h4",{className:"font-bold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(i,{className:"w-5 h-5"}),"Desglose por Categor칤a"]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-white border-b-2 border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Categor칤a"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Items"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Unidades"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Valor Inventario"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"% del Depto"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:Object.entries(s.por_categoria).sort(([,e],[,s])=>s.valor_inventario-e.valor_inventario).map(([e,r])=>{const l=(r.valor_inventario/s.valor_inventario*100).toFixed(1);return t.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e}),t.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:r.total_items}),t.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:r.total_unidades}),t.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-right text-gray-900",children:y(r.valor_inventario)}),t.jsx("td",{className:"px-4 py-3 text-sm text-right",children:t.jsxs("span",{className:`inline-flex px-2 py-1 rounded-full ${a.badge} font-semibold`,children:[l,"%"]})})]},e)})})]})})]})]},e)})})]})},T=()=>{const[e,s]=l.useState(null),[a,r]=l.useState(null),[n,i]=l.useState(!0),[d,x]=l.useState(null),[m,h]=l.useState(5),[p,N]=l.useState(""),[y,f]=l.useState(""),[v,w]=l.useState(!0),[_,C]=l.useState(!0),k=async()=>{i(!0),x(null);try{const[e,t]=await Promise.all([P(),F(m)]);s(e),r(t)}catch(e){x(e.message)}finally{i(!1)}};l.useEffect(()=>{k()},[m]);const A=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),S=e=>e?e.filter(e=>{const s=!p||e.departamento===p,t=!y||e.categoria===y;return s&&t}):[];if(n)return t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600"}),t.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Cargando alertas de stock..."})]})});if(d)return t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(o,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar alertas"}),t.jsx("p",{className:"text-sm",children:d})]})]}),t.jsxs("button",{onClick:k,className:"mt-4 flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Reintentar"]})]});const E=S((null==e?void 0:e.products)||[]),$=S((null==a?void 0:a.products)||[]);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Alertas de Stock"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Productos sin stock y con inventario bajo"})]}),t.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Actualizar"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-6",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:t.jsx(o,{className:"w-8 h-8 text-red-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Sin Stock"}),t.jsx("p",{className:"text-4xl font-bold text-red-700",children:(null==e?void 0:e.total)||0})]})]})}),t.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-xl p-6",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:t.jsx(u,{className:"w-8 h-8 text-yellow-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-yellow-600 font-medium",children:"Bajo Stock"}),t.jsx("p",{className:"text-4xl font-bold text-yellow-700",children:(null==a?void 0:a.total)||0})]})]})}),t.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-blue-600 font-medium mb-2",children:"Umbral de Stock Bajo"}),t.jsx("input",{type:"number",min:"1",max:"20",value:m,onChange:e=>h(parseInt(e.target.value)||5),className:"w-full px-4 py-2 text-2xl font-bold text-blue-700 bg-white border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["Productos con menos de ",m," unidades"]})]})})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx(j,{className:"w-5 h-5 text-gray-600"}),t.jsx("h3",{className:"font-semibold text-gray-900",children:"Filtros"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Departamento"}),t.jsxs("select",{value:p,onChange:e=>N(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Todos"}),(()=>{const s=new Set;return(null==e?void 0:e.products)&&e.products.forEach(e=>s.add(e.departamento)),(null==a?void 0:a.products)&&a.products.forEach(e=>s.add(e.departamento)),Array.from(s).sort()})().map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categor칤a"}),t.jsxs("select",{value:y,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Todas"}),(()=>{const s=new Set;return(null==e?void 0:e.products)&&e.products.forEach(e=>s.add(e.categoria)),(null==a?void 0:a.products)&&a.products.forEach(e=>s.add(e.categoria)),Array.from(s).sort()})().map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("button",{onClick:()=>{N(""),f("")},className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all",children:"Limpiar Filtros"})})]})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-red-200",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-red-50 transition-colors",onClick:()=>w(!v),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(o,{className:"w-6 h-6 text-red-600"}),t.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:["Productos Sin Stock (",E.length,")"]})]}),v?t.jsx(g,{className:"w-5 h-5 text-gray-600"}):t.jsx(b,{className:"w-5 h-5 text-gray-600"})]}),v&&t.jsx("div",{className:"border-t border-red-200 overflow-x-auto",children:E.length>0?t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-red-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Producto"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Categor칤a"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Departamento"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Precio Venta"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:E.map(e=>t.jsxs("tr",{className:"hover:bg-red-50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.id}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e.nombre}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.categoria}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:e.departamento})}),t.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-right text-gray-900",children:A(e.precio_venta)})]},e.id))})]}):t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No hay productos sin stock con los filtros seleccionados"})})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-yellow-200",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-yellow-50 transition-colors",onClick:()=>C(!_),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(u,{className:"w-6 h-6 text-yellow-600"}),t.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:["Productos con Bajo Stock (",$.length,")"]})]}),_?t.jsx(g,{className:"w-5 h-5 text-gray-600"}):t.jsx(b,{className:"w-5 h-5 text-gray-600"})]}),_&&t.jsx("div",{className:"border-t border-yellow-200 overflow-x-auto",children:$.length>0?t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-yellow-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Producto"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Categor칤a"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Departamento"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Stock"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Precio Venta"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:$.map(e=>t.jsxs("tr",{className:"hover:bg-yellow-50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.id}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e.nombre}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.categoria}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:e.departamento})}),t.jsx("td",{className:"px-4 py-3 text-center",children:t.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-bold rounded-full bg-yellow-100 text-yellow-800",children:e.cantidad_disponible})}),t.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-right text-gray-900",children:A(e.precio_venta)})]},e.id))})]}):t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No hay productos con bajo stock con los filtros seleccionados"})})]})]})},D=()=>{const[a,r]=l.useState(null),[n,i]=l.useState(!0),[d,x]=l.useState(null),m=async()=>{i(!0),x(null);try{const t=await(async()=>{const t="/api/inventory/abc-analysis";try{e.info("Obteniendo an치lisis ABC:",t);const a=await s(t);if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||"Error al obtener an치lisis ABC")}const r=await a.json();return e.info("An치lisis ABC obtenido exitosamente"),r}catch(d){throw e.error("Error al obtener an치lisis ABC:",d.message),d}})();r(t.data)}catch(t){x(t.message)}finally{i(!1)}};l.useEffect(()=>{m()},[]);const h=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),p=e=>({clase_A:{bg:"bg-red-50",border:"border-red-300",text:"text-red-700",badge:"bg-red-100 text-red-800",primary:"bg-red-500",label:"Clase A - CR칈TICOS"},clase_B:{bg:"bg-yellow-50",border:"border-yellow-300",text:"text-yellow-700",badge:"bg-yellow-100 text-yellow-800",primary:"bg-yellow-500",label:"Clase B - IMPORTANTES"},clase_C:{bg:"bg-green-50",border:"border-green-300",text:"text-green-700",badge:"bg-green-100 text-green-800",primary:"bg-green-500",label:"Clase C - NORMALES"}}[e]);if(n)return t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"}),t.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Cargando an치lisis ABC..."})]})});if(d)return t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(o,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar an치lisis"}),t.jsx("p",{className:"text-sm",children:d})]})]}),t.jsxs("button",{onClick:m,className:"mt-4 flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Reintentar"]})]});if(!a)return t.jsx("div",{className:"text-center py-12 text-gray-500",children:"No hay datos de an치lisis ABC disponibles"});const g=["clase_A","clase_B","clase_C"];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"An치lisis ABC (Pareto)"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Clasificaci칩n de productos seg칰n su valor"})]}),t.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Actualizar"]})]}),t.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(N,{className:"w-6 h-6 text-blue-600 flex-shrink-0 mt-1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-blue-900 mb-2",children:"쯈u칠 es el An치lisis ABC?"}),t.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"El an치lisis ABC clasifica los productos seg칰n su contribuci칩n al valor total del inventario, siguiendo el principio de Pareto (80/20):"}),t.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-bold text-red-600",children:"Clase A (Cr칤ticos):"}),t.jsx("span",{children:"~20% de los productos representan ~80% del valor total. Requieren control estricto."})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-bold text-yellow-600",children:"Clase B (Importantes):"}),t.jsx("span",{children:"~30% de los productos representan ~15% del valor. Control moderado."})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-bold text-green-600",children:"Clase C (Normales):"}),t.jsx("span",{children:"~50% de los productos representan ~5% del valor. Control b치sico."})]})]})]})]})}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-6",children:"Distribuci칩n ABC"}),t.jsx("div",{className:"space-y-4",children:g.map(e=>{const s=a[e],r=p(e);return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:`font-bold ${r.text}`,children:r.label}),t.jsxs("div",{className:"text-right",children:[t.jsxs("span",{className:"font-semibold text-gray-900",children:[s.porcentaje_valor.toFixed(1),"% del valor"]}),t.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",s.porcentaje_items.toFixed(1),"% items)"]})]})]}),t.jsx("div",{className:"w-full h-8 bg-gray-200 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${r.primary} transition-all flex items-center justify-end pr-3`,style:{width:`${s.porcentaje_valor}%`},children:t.jsx("span",{className:"text-white text-sm font-bold",children:s.porcentaje_valor>10?`${s.porcentaje_valor.toFixed(1)}%`:""})})})]},e)})})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:g.map(e=>{const s=a[e],r=p(e);return t.jsxs("div",{className:`bg-white rounded-xl shadow-lg border-2 ${r.border} overflow-hidden`,children:[t.jsx("div",{className:`${r.bg} border-b-2 ${r.border} p-4`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-3 ${r.badge} rounded-lg`,children:t.jsx(y,{className:"w-6 h-6"})}),t.jsx("div",{children:t.jsx("h3",{className:`text-lg font-bold ${r.text}`,children:r.label})})]})}),t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Cantidad de Items"}),t.jsxs("div",{className:"flex items-baseline gap-2",children:[t.jsx("p",{className:`text-3xl font-bold ${r.text}`,children:s.cantidad_items}),t.jsxs("span",{className:`text-sm font-semibold ${r.badge} px-2 py-1 rounded-full`,children:[s.porcentaje_items.toFixed(1),"%"]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Valor de Inventario"}),t.jsx("p",{className:`text-xl font-bold ${r.text}`,children:h(s.valor_inventario)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Contribuci칩n al Valor Total"}),t.jsx("div",{className:"w-full h-3 bg-gray-200 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${r.primary}`,style:{width:`${s.porcentaje_valor}%`}})}),t.jsxs("p",{className:`text-2xl font-bold ${r.text} mt-2`,children:[s.porcentaje_valor.toFixed(1),"%"]})]}),t.jsxs("div",{className:`${r.bg} rounded-lg p-3 mt-4`,children:[t.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"RECOMENDACI칍N:"}),t.jsxs("p",{className:"text-xs text-gray-700",children:["clase_A"===e&&"Control estricto, monitoreo constante, reabastecimiento prioritario","clase_B"===e&&"Control moderado, revisiones peri칩dicas, planificaci칩n est치ndar","clase_C"===e&&"Control b치sico, pedidos por lotes, revisi칩n ocasional"]})]})]})]},e)})}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Tabla Comparativa"})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Clase"}),t.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-gray-700",children:"Items"}),t.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-gray-700",children:"% Items"}),t.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"Valor Inventario"}),t.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-gray-700",children:"% Valor"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:g.map(e=>{const s=a[e],r=p(e);return t.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`inline-flex px-3 py-1 rounded-full ${r.badge} font-bold`,children:r.label})}),t.jsx("td",{className:"px-6 py-4 text-center text-gray-900 font-semibold",children:s.cantidad_items}),t.jsx("td",{className:"px-6 py-4 text-center",children:t.jsxs("span",{className:"text-gray-600 font-medium",children:[s.porcentaje_items.toFixed(1),"%"]})}),t.jsx("td",{className:"px-6 py-4 text-right text-gray-900 font-bold",children:h(s.valor_inventario)}),t.jsx("td",{className:"px-6 py-4 text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${r.primary}`,style:{width:`${s.porcentaje_valor}%`}})}),t.jsxs("span",{className:`font-bold ${r.text}`,children:[s.porcentaje_valor.toFixed(1),"%"]})]})})]},e)})})]})})]})]})},R=()=>{const[a,r]=l.useState(null),[n,i]=l.useState(!0),[d,x]=l.useState(null),[p,g]=l.useState(20),b=async()=>{i(!0),x(null);try{const t=await(async(t=20)=>{const a=`/api/inventory/top-by-value?limit=${t}`;try{e.info("Obteniendo top productos por valor:",a);const t=await s(a);if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.error||"Error al obtener top productos")}const r=await t.json();return e.info("Top productos obtenidos exitosamente"),r}catch(d){throw e.error("Error al obtener top productos:",d.message),d}})(p);r(t)}catch(t){x(t.message)}finally{i(!1)}};l.useEffect(()=>{b()},[p]);const u=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),j=e=>1===e?{icon:"游볞",color:"bg-yellow-100 text-yellow-800 border-yellow-300"}:2===e?{icon:"游볟",color:"bg-gray-100 text-gray-800 border-gray-300"}:3===e?{icon:"游볠",color:"bg-orange-100 text-orange-800 border-orange-300"}:{icon:`#${e}`,color:"bg-blue-100 text-blue-800 border-blue-300"},N=(e,s)=>s&&0!==s?((s-e)/s*100).toFixed(1):0;if(n)return t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"}),t.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Cargando top productos..."})]})});if(d)return t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(o,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar top productos"}),t.jsx("p",{className:"text-sm",children:d})]})]}),t.jsxs("button",{onClick:b,className:"mt-4 flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Reintentar"]})]});if(!(null==a?void 0:a.products)||0===a.products.length)return t.jsx("div",{className:"text-center py-12 text-gray-500",children:"No hay datos de productos disponibles"});const y=(null==a?void 0:a.products)?a.products.reduce((e,s)=>e+s.valor_inventario,0):0;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Top Productos por Valor"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Productos con mayor valor en inventario"})]}),t.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Actualizar"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200",children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Cantidad de Productos"}),t.jsx("div",{className:"flex gap-2",children:[10,20,50].map(e=>t.jsxs("button",{onClick:()=>g(e),className:"flex-1 px-4 py-2 rounded-lg font-semibold transition-all "+(p===e?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Top ",e]},e))})]}),t.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl shadow-md p-6 border border-blue-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 bg-blue-200 rounded-lg",children:t.jsx(f,{className:"w-6 h-6 text-blue-700"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Productos Mostrados"}),t.jsx("p",{className:"text-3xl font-bold text-blue-900",children:a.products.length})]})]})}),t.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl shadow-md p-6 border border-green-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 bg-green-200 rounded-lg",children:t.jsx(m,{className:"w-6 h-6 text-green-700"})}),t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm text-green-700 font-medium",children:["Valor Total (Top ",p,")"]}),t.jsx("p",{className:"text-2xl font-bold text-green-900",children:u(y)})]})]})})]}),a.products.length>=3&&t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:a.products.slice(0,3).map((e,s)=>{const a=s+1,r=j(a);return N(e.costo_unitario,e.precio_venta),t.jsxs("div",{className:`bg-white rounded-xl shadow-lg border-2 ${r.color.split(" ").pop().replace("text-","border-")} overflow-hidden transform hover:scale-105 transition-transform`,children:[t.jsxs("div",{className:`${r.color} p-4 text-center border-b-2`,children:[t.jsx("div",{className:"text-4xl mb-2",children:r.icon}),t.jsxs("p",{className:"font-bold text-lg",children:["Posici칩n ",a]})]}),t.jsxs("div",{className:"p-6 space-y-3",children:[t.jsx("h4",{className:"font-bold text-gray-900 text-sm line-clamp-2 min-h-[40px]",children:e.nombre}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Categor칤a:"}),t.jsx("span",{className:"font-semibold text-gray-900",children:e.categoria})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Cantidad:"}),t.jsxs("span",{className:"font-bold text-blue-600",children:[e.cantidad," uds"]})]}),t.jsxs("div",{className:"border-t pt-3",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Valor en Inventario"}),t.jsx("p",{className:"text-2xl font-bold text-purple-600",children:u(e.valor_inventario)})]})]})]},e.id)})}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(h,{className:"w-6 h-6 text-purple-600"}),t.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Ranking Completo"})]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50 border-b-2 border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700 w-20",children:"Rank"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Producto"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Categor칤a"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Depto"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Cantidad"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Costo Unit."}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Precio Venta"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Valor Inv."}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Valor Venta"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Margen"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"% Total"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:a.products.map((e,s)=>{const a=s+1,r=j(a),l=N(e.costo_unitario,e.precio_venta),n=(e.valor_inventario/y*100).toFixed(1);return t.jsxs("tr",{className:"hover:bg-purple-50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3 text-center",children:t.jsx("span",{className:`inline-flex items-center justify-center w-10 h-10 rounded-full border-2 ${r.color} font-bold text-sm`,children:a})}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 max-w-xs truncate",children:e.nombre}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.categoria}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:e.departamento})}),t.jsx("td",{className:"px-4 py-3 text-center",children:t.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-bold rounded-full bg-gray-100 text-gray-800",children:e.cantidad})}),t.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-700",children:u(e.costo_unitario)}),t.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-right text-gray-900",children:u(e.precio_venta)}),t.jsx("td",{className:"px-4 py-3 text-sm font-bold text-right text-purple-700",children:u(e.valor_inventario)}),t.jsx("td",{className:"px-4 py-3 text-sm font-bold text-right text-green-700",children:u(e.valor_potencial_venta)}),t.jsx("td",{className:"px-4 py-3 text-center",children:t.jsxs("span",{className:"inline-flex px-2 py-1 text-xs font-bold rounded-full "+(l>=20?"bg-green-100 text-green-800":l>=10?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[l,"%"]})}),t.jsx("td",{className:"px-4 py-3 text-center",children:t.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.jsx("div",{className:"w-16 h-2 bg-gray-200 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-purple-500",style:{width:`${n}%`}})}),t.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:[n,"%"]})]})})]},e.id)})})]})})]})]})},B=()=>{const[e,s]=l.useState(null),[a,r]=l.useState(null),[n,i]=l.useState(!0),[d,x]=l.useState(null),[m,h]=l.useState(!0),[u,j]=l.useState(!0),N=async()=>{i(!0),x(null);try{const[e,t]=await Promise.all([$(),I()]);s(e.categories),r(t.sizes)}catch(e){x(e.message)}finally{i(!1)}};l.useEffect(()=>{N()},[]);const y=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),f=e=>e?e.reduce((e,s)=>e+(s.valor_inventario||0),0):0;if(n)return t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"}),t.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Cargando an치lisis de categor칤as y tallas..."})]})});if(d)return t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 text-red-800",children:[t.jsx(o,{className:"w-6 h-6"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Error al cargar an치lisis"}),t.jsx("p",{className:"text-sm",children:d})]})]}),t.jsxs("button",{onClick:N,className:"mt-4 flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Reintentar"]})]});const w=f(e),_=f(a);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Categor칤as y Tallas"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"An치lisis detallado por categor칤a y talla"})]}),t.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all",children:[t.jsx(c,{className:"w-4 h-4"}),"Actualizar"]})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200 cursor-pointer hover:from-blue-100 hover:to-indigo-100 transition-colors",onClick:()=>h(!m),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:t.jsx(p,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"An치lisis por Categor칤a"}),t.jsxs("p",{className:"text-sm text-gray-600",children:[(null==e?void 0:e.length)||0," categor칤as - Valor total: ",y(w)]})]})]}),m?t.jsx(g,{className:"w-5 h-5 text-gray-600"}):t.jsx(b,{className:"w-5 h-5 text-gray-600"})]}),m&&e&&t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"mb-6 space-y-3",children:e.sort((e,s)=>s.valor_inventario-e.valor_inventario).slice(0,10).map((e,s)=>{const a=w>0?e.valor_inventario/w*100:0;return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-700 text-xs font-bold",children:s+1}),t.jsx("span",{className:"font-semibold text-gray-900",children:e.categoria})]}),t.jsxs("span",{className:"text-sm text-gray-600",children:[a.toFixed(1),"% - ",y(e.valor_inventario)]})]}),t.jsx("div",{className:"w-full h-8 bg-gray-200 rounded-lg overflow-hidden",children:t.jsxs("div",{className:"h-full bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-between px-3 transition-all",style:{width:`${Math.max(a,5)}%`},children:[t.jsxs("span",{className:"text-white text-xs font-semibold",children:[e.total_items," items"]}),t.jsxs("span",{className:"text-white text-xs font-semibold",children:[e.total_unidades," uds"]})]})})]},e.categoria)})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50 border-y border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"#"}),t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Categor칤a"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Items"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Unidades"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Valor Inventario"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"% del Total"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:e.sort((e,s)=>s.valor_inventario-e.valor_inventario).map((e,s)=>{const a=w>0?e.valor_inventario/w*100:0;return t.jsxs("tr",{className:"hover:bg-blue-50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s+1}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e.categoria}),t.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-700",children:e.total_items}),t.jsx("td",{className:"px-4 py-3 text-sm text-center font-semibold text-blue-600",children:e.total_unidades}),t.jsx("td",{className:"px-4 py-3 text-sm font-bold text-right text-gray-900",children:y(e.valor_inventario)}),t.jsx("td",{className:"px-4 py-3 text-center",children:t.jsxs("span",{className:"inline-flex px-3 py-1 text-xs font-bold rounded-full bg-blue-100 text-blue-800",children:[a.toFixed(1),"%"]})})]},e.categoria)})})]})})]})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 bg-gradient-to-r from-purple-50 to-pink-50 border-b border-gray-200 cursor-pointer hover:from-purple-100 hover:to-pink-100 transition-colors",onClick:()=>j(!u),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:t.jsx(v,{className:"w-6 h-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"An치lisis por Talla"}),t.jsxs("p",{className:"text-sm text-gray-600",children:[(null==a?void 0:a.length)||0," tallas - Valor total: ",y(_)]})]})]}),u?t.jsx(g,{className:"w-5 h-5 text-gray-600"}):t.jsx(b,{className:"w-5 h-5 text-gray-600"})]}),u&&a&&t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"mb-6 space-y-3",children:a.sort((e,s)=>s.total_unidades-e.total_unidades).slice(0,15).map((e,s)=>{const r=Math.max(...a.map(e=>e.total_unidades)),l=r>0?e.total_unidades/r*100:0;return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"inline-flex items-center justify-center w-16 h-8 rounded-lg bg-purple-100 text-purple-700 text-sm font-bold border-2 border-purple-300",children:e.talla}),t.jsxs("span",{className:"text-sm text-gray-600",children:[e.cantidad_items," items diferentes"]})]}),t.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[e.total_unidades," unidades"]})]}),t.jsx("div",{className:"w-full h-6 bg-gray-200 rounded-lg overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-end px-3 transition-all",style:{width:`${Math.max(l,5)}%`},children:t.jsx("span",{className:"text-white text-xs font-semibold",children:y(e.valor_inventario)})})})]},e.talla)})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50 border-y border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Talla"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Items Diferentes"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Total Unidades"}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Valor Inventario"}),t.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"% del Total (Valor)"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:a.sort((e,s)=>s.valor_inventario-e.valor_inventario).map(e=>{const s=_>0?e.valor_inventario/_*100:0;return t.jsxs("tr",{className:"hover:bg-purple-50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:"inline-flex items-center justify-center min-w-[60px] px-3 py-1 rounded-lg bg-purple-100 text-purple-800 text-sm font-bold border border-purple-300",children:e.talla})}),t.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-700",children:e.cantidad_items}),t.jsx("td",{className:"px-4 py-3 text-sm text-center font-bold text-purple-600",children:e.total_unidades}),t.jsx("td",{className:"px-4 py-3 text-sm font-bold text-right text-gray-900",children:y(e.valor_inventario)}),t.jsx("td",{className:"px-4 py-3 text-center",children:t.jsxs("span",{className:"inline-flex px-3 py-1 text-xs font-bold rounded-full bg-purple-100 text-purple-800",children:[s.toFixed(1),"%"]})})]},e.talla)})})]})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl shadow-md p-6 border border-blue-200",children:[t.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-4",children:"Resumen de Categor칤as"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-700",children:"Total Categor칤as:"}),t.jsx("span",{className:"text-lg font-bold text-blue-700",children:(null==e?void 0:e.length)||0})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-700",children:"Valor Total:"}),t.jsx("span",{className:"text-lg font-bold text-blue-700",children:y(w)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-700",children:"Promedio por Categor칤a:"}),t.jsx("span",{className:"text-lg font-bold text-blue-700",children:y((null==e?void 0:e.length)?w/e.length:0)})]})]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-100 rounded-xl shadow-md p-6 border border-purple-200",children:[t.jsx("h4",{className:"text-sm font-semibold text-purple-900 mb-4",children:"Resumen de Tallas"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-700",children:"Total Tallas:"}),t.jsx("span",{className:"text-lg font-bold text-purple-700",children:(null==a?void 0:a.length)||0})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-700",children:"Valor Total:"}),t.jsx("span",{className:"text-lg font-bold text-purple-700",children:y(_)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-700",children:"Promedio por Talla:"}),t.jsx("span",{className:"text-lg font-bold text-purple-700",children:y((null==a?void 0:a.length)?_/a.length:0)})]})]})]})]})]})},M=()=>{var c,x;a("An치lisis de Inventario");const[m,g]=l.useState(!1),[b,j]=l.useState(""),[N,f]=l.useState(null),[E,$]=l.useState(null),[I,P]=l.useState(null),[F,M]=l.useState("dashboard"),[U,z]=l.useState(r()),[q,L]=l.useState(null),[Q,G]=l.useState(null),K=l.useRef(null),J=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0),W=[{id:"dashboard",label:"Dashboard",icon:S,description:"Resumen ejecutivo"},{id:"departamentos",label:"Departamentos",icon:p,description:"Por departamento"},{id:"alertas",label:"Alertas de Stock",icon:u,description:"Stock bajo y sin stock"},{id:"abc",label:"An치lisis ABC",icon:y,description:"Clasificaci칩n Pareto"},{id:"top-productos",label:"Top Productos",icon:h,description:"Mayor valor"},{id:"categorias-tallas",label:"Categor칤as y Tallas",icon:v,description:"An치lisis detallado"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-cyan-600 rounded-xl shadow-lg p-6 text-white",children:t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(i,{className:"w-10 h-10"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:"An치lisis de Inventario"}),t.jsx("p",{className:"text-teal-50 mt-1",children:"Consulta directa desde Alegra o carga manual de archivos"})]})]})}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Obtener Inventario"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Seleccione una opci칩n para analizar el inventario"}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"border-2 border-teal-200 rounded-xl p-6 bg-teal-50",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(d,{className:"w-6 h-6 text-teal-600"}),t.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Consulta Directa desde Alegra"})]}),t.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Obtiene el inventario actual directamente desde Alegra API.",t.jsx("span",{className:"font-semibold text-teal-700",children:" Puede tardar entre 1 y 3 minutos."})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(w,{className:"w-4 h-4 inline mr-1"}),"Fecha del Inventario"]}),t.jsx("input",{type:"date",value:U,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent",disabled:m}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Selecciona la fecha hasta la cual deseas consultar el inventario"})]}),t.jsxs("button",{onClick:async()=>{g(!0),f(null),j("Consultando inventario desde Alegra... Esto puede tomar entre 1 y 3 minutos."),L(null),G(null);try{const e={toDate:U,limit:3e3,page:1},s=await n(e);if(!s.success)throw new Error(s.error||"Error al obtener inventario");{if(!s.data||0===s.data.length)return f("No se encontraron productos en el inventario para esta fecha. Los items pueden haber sido filtrados por estar deshabilitados o tener nombres con asteriscos (*)."),$(null),void P(null);const e=(e=>{const s=e.map(e=>{var s,t;return{item:e.name||"Sin nombre",categoria:(null==(s=e.category)?void 0:s.name)||"Sin categor칤a",departamento:(null==(t=e.category)?void 0:t.name)||"General",cantidad:e.quantity||0,costo:e.unit_price||0,total:e.total_value||0,referencia:e.reference||"",id:e.id}}),t=s.length,a=s.reduce((e,s)=>e+s.cantidad,0),r=s.reduce((e,s)=>e+s.total,0),l=s.reduce((e,s)=>{const t=s.departamento;return e[t]||(e[t]={items:[],totalValue:0,totalQuantity:0}),e[t].items.push(s),e[t].totalValue+=s.total,e[t].totalQuantity+=s.cantidad,e},{}),n=s.reduce((e,s)=>{const t=s.categoria;return e[t]||(e[t]={items:[],totalValue:0,totalQuantity:0}),e[t].items.push(s),e[t].totalValue+=s.total,e[t].totalQuantity+=s.cantidad,e},{}),i=s.filter(e=>0===e.cantidad),d=s.filter(e=>e.cantidad>0&&e.cantidad<=5),o=[...s].sort((e,s)=>s.total-e.total).slice(0,20),c=[...s].sort((e,s)=>s.total-e.total);let x=0;const m=c.map(e=>{x+=e.total;const s=x/r*100;let t="C";return s<=80?t="A":s<=95&&(t="B"),{...e,classification:t,cumulativePercentage:s}}),h=m.filter(e=>"A"===e.classification),p=m.filter(e=>"B"===e.classification),g=m.filter(e=>"C"===e.classification);return{success:!0,items_completos:s,resumen:{total_items:t,total_quantity:a,total_value:r,average_cost:r/a||0},by_department:l,by_category:n,stock_alerts:{out_of_stock:i,low_stock:d},top_products:o,abc_analysis:{class_a:h,class_b:p,class_c:g,summary:{a_count:h.length,a_percentage:h.length/t*100,a_value:h.reduce((e,s)=>e+s.total,0),b_count:p.length,b_percentage:p.length/t*100,b_value:p.reduce((e,s)=>e+s.total,0),c_count:g.length,c_percentage:g.length/t*100,c_value:g.reduce((e,s)=>e+s.total,0)}}}})(s.data);$(e),P(s.metadata),L("api"),M("dashboard")}}catch(e){f(e.message||"Error al obtener inventario desde Alegra. Verifique que el servidor est칠 funcionando y que tenga conexi칩n a internet."),$(null),P(null)}finally{g(!1),j("")}},disabled:m,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-md",children:[t.jsx(d,{className:"w-5 h-5"}),"Consultar Inventario"]})]}),t.jsxs("div",{className:"border-2 border-blue-200 rounded-xl p-6 bg-blue-50",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(_,{className:"w-6 h-6 text-blue-600"}),t.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Cargar Archivo Manual"})]}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Sube un archivo CSV o Excel exportado desde Alegra para an치lisis offline."}),Q&&t.jsxs("div",{className:"mb-4 flex items-center gap-2 text-sm text-gray-600 bg-white p-3 rounded-lg border border-blue-200",children:[t.jsx(C,{className:"w-4 h-4 text-blue-600"}),t.jsxs("span",{children:["Archivo: ",t.jsx("strong",{children:Q})]})]}),t.jsxs("button",{onClick:()=>{var e;return null==(e=K.current)?void 0:e.click()},disabled:m,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-md",children:[t.jsx(_,{className:"w-5 h-5"}),"Cargar Archivo"]}),t.jsx("input",{ref:K,type:"file",accept:".csv,.xlsx,.xls",onChange:async t=>{const a=t.target.files[0];if(!a)return;const r="."+a.name.split(".").pop().toLowerCase();if([".csv",".xlsx",".xls"].includes(r)){g(!0),f(null),j("Procesando archivo de inventario..."),L(null),G(a.name);try{const t=await(async t=>{try{e.info("Subiendo archivo de inventario:",t.name);const a=new FormData;a.append("file",t);const r=await s("/api/inventory/upload-file",{method:"POST",body:a},6e4);if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.error||"Error al procesar el archivo")}const l=await r.json();return e.info("Archivo procesado exitosamente"),l}catch(N){throw e.error("Error al subir archivo de inventario:",N.message),N}})(a);t.success?($(t),P(null),L("file"),M("dashboard")):(f("Error al procesar el archivo"),$(null))}catch(l){f(l.message||"Error al cargar el archivo"),$(null)}finally{g(!1),j(""),K.current&&(K.current.value="")}}else f("Formato no soportado. Use CSV o Excel (.csv, .xlsx, .xls)")},style:{display:"none"}})]})]})]}),m&&t.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-teal-50 border-2 border-blue-300 rounded-xl p-8",children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx(k,{className:"w-16 h-16 text-blue-600 animate-spin"}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"font-bold text-xl text-blue-900 mb-2",children:"Procesando..."}),t.jsx("p",{className:"text-blue-700 mb-4",children:b}),null===q&&U&&t.jsx("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-4 max-w-md mx-auto",children:t.jsx("p",{className:"text-sm text-yellow-800 font-medium",children:"낌勇 Por favor espere. El proceso puede tardar entre 1 y 3 minutos mientras se consulta todo el inventario."})})]})]})}),N&&!m&&t.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-6",children:t.jsxs("div",{className:"flex items-start gap-3 text-red-800",children:[t.jsx(o,{className:"w-6 h-6 flex-shrink-0 mt-1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-lg",children:"Error al obtener inventario"}),t.jsx("p",{className:"text-sm mt-1",children:N}),I&&I.total_filtered>0&&t.jsxs("div",{className:"mt-3 text-sm",children:[t.jsx("p",{className:"font-semibold",children:"Informaci칩n del filtrado:"}),t.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[t.jsxs("li",{children:["Items recibidos de Alegra: ",I.total_received]}),I.total_filtered_asterisk>0&&t.jsxs("li",{children:["Items filtrados (asteriscos): ",I.total_filtered_asterisk]}),I.total_filtered_disabled>0&&t.jsxs("li",{children:["Items filtrados (deshabilitados): ",I.total_filtered_disabled]}),t.jsxs("li",{children:["Total filtrados: ",I.total_filtered]})]})]})]})]})}),E&&!m&&!N&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(A,{className:"w-6 h-6 text-green-600"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold text-green-900",children:"An치lisis completado exitosamente"}),t.jsx("p",{className:"text-sm text-green-700",children:"api"===q?`Inventario obtenido desde Alegra (Fecha: ${U})`:`Archivo cargado: ${Q}`})]})]}),I&&"api"===q&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-green-200",children:[t.jsx("p",{className:"text-sm text-green-800 font-semibold mb-2",children:"Informaci칩n del procesamiento:"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[t.jsxs("div",{className:"bg-white rounded-lg p-2 border border-green-200",children:[t.jsx("p",{className:"text-gray-600",children:"Recibidos"}),t.jsx("p",{className:"font-bold text-green-900",children:I.total_received})]}),I.total_filtered_asterisk>0&&t.jsxs("div",{className:"bg-white rounded-lg p-2 border border-yellow-200",children:[t.jsx("p",{className:"text-gray-600",children:"Asteriscos"}),t.jsx("p",{className:"font-bold text-yellow-900",children:I.total_filtered_asterisk})]}),I.total_filtered_disabled>0&&t.jsxs("div",{className:"bg-white rounded-lg p-2 border border-orange-200",children:[t.jsx("p",{className:"text-gray-600",children:"Deshabilitados"}),t.jsx("p",{className:"font-bold text-orange-900",children:I.total_filtered_disabled})]}),t.jsxs("div",{className:"bg-white rounded-lg p-2 border border-green-200",children:[t.jsx("p",{className:"text-gray-600",children:"V치lidos"}),t.jsx("p",{className:"font-bold text-green-900",children:I.total_returned})]})]})]})]}),E.resumen&&t.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl shadow-md p-6 border border-purple-200",children:[t.jsx("h3",{className:"text-xl font-bold text-purple-900 mb-4",children:"游늵 Resumen del Inventario"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-200",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Items"}),t.jsx("p",{className:"text-2xl font-bold text-purple-900",children:(null==(c=E.resumen.total_items)?void 0:c.toLocaleString("es-CO"))||0})]}),t.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Cantidad Total"}),t.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(null==(x=E.resumen.total_quantity)?void 0:x.toLocaleString("es-CO"))||0})]}),t.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Valor Total"}),t.jsx("p",{className:"text-2xl font-bold text-green-900",children:J(E.resumen.total_value||0)})]}),t.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Costo Promedio"}),t.jsx("p",{className:"text-2xl font-bold text-orange-900",children:J(E.resumen.average_cost||0)})]})]})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 border border-gray-200",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Seleccionar Vista de An치lisis"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:W.map(e=>{const s=e.icon,a=F===e.id;return t.jsxs("button",{onClick:()=>M(e.id),className:"flex flex-col items-center gap-2 p-4 rounded-lg transition-all border-2 "+(a?"bg-teal-600 text-white border-teal-600 shadow-lg transform scale-105":"bg-gray-50 text-gray-700 hover:bg-teal-50 hover:text-teal-700 border-gray-200"),children:[t.jsx(s,{className:"w-6 h-6 "+(a?"text-white":"text-gray-600")}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-sm font-bold "+(a?"text-white":"text-gray-900"),children:e.label}),t.jsx("div",{className:"text-xs "+(a?"text-teal-100":"text-gray-500"),children:e.description})]})]},e.id)})})]}),t.jsx("div",{className:"bg-white rounded-xl shadow-md p-6 border border-gray-200",children:(()=>{if(!E)return null;switch(F){case"dashboard":default:return t.jsx(V,{data:E});case"departamentos":return t.jsx(O,{data:E});case"alertas":return t.jsx(T,{data:E});case"abc":return t.jsx(D,{data:E});case"top-productos":return t.jsx(R,{data:E});case"categorias-tallas":return t.jsx(B,{data:E})}})()})]})]})};export{M as default};
