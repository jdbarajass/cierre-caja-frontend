import{a as e,g as t,j as s}from"./index-BfKDcaF7.js";import{r as a}from"./react-vendor-CfGu_lG-.js";import{a as r}from"./directApiService-B099-F3Q.js";import{T as l,C as d,A as n,i as o}from"./icons-yh9a4XSz.js";const c=()=>{e("Totales de Ventas - Estadísticas Avanzadas");const[c,i]=a.useState(!1),[x,m]=a.useState(null),[p,h]=a.useState([]),[g,u]=a.useState(null),[j,b]=a.useState(()=>{const e=new Date;return e.setDate(e.getDate()-30),e.toISOString().split("T")[0]}),[y,N]=a.useState(t()),[f,v]=a.useState("day"),[w,S]=a.useState(30);a.useEffect(()=>{j&&y&&(async()=>{i(!0),m(null);try{const e={from:j,to:y,groupBy:f,limit:w},t=await r(e);if(!t.success)throw new Error(t.error||"Error al obtener totales de ventas");h(t.data||[]),u(t.metadata||null)}catch(e){m(e.message),h([]),u(null)}finally{i(!1)}})()},[j,y,f,w]);const T=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e||0),k=e=>{if("month"===f){const[t,s]=e.split("-");return new Date(t,s-1,1).toLocaleDateString("es-CO",{year:"numeric",month:"long"})}return new Date(e+"T00:00:00").toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric",weekday:"short"})},C=p.reduce((e,t)=>e+(t.total||0),0),D=p.reduce((e,t)=>e+(t.count||0),0),O=D>0?C/D:0;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl shadow-lg p-6 text-white",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(l,{className:"w-8 h-8"}),s.jsx("h1",{className:"text-2xl font-bold",children:"Totales de Ventas"})]}),s.jsx("p",{className:"text-purple-50",children:"Consulta rápida de totales de ventas agrupados por día o mes"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Filtros"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s.jsx(d,{className:"w-4 h-4 inline mr-1"}),"Desde"]}),s.jsx("input",{type:"date",value:j,onChange:e=>b(e.target.value),max:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s.jsx(d,{className:"w-4 h-4 inline mr-1"}),"Hasta"]}),s.jsx("input",{type:"date",value:y,onChange:e=>N(e.target.value),min:j,max:t(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Agrupar por"}),s.jsxs("select",{value:f,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[s.jsx("option",{value:"day",children:"Por Día"}),s.jsx("option",{value:"month",children:"Por Mes"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Límite de resultados"}),s.jsxs("select",{value:w,onChange:e=>S(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[s.jsx("option",{value:7,children:"7 resultados"}),s.jsx("option",{value:15,children:"15 resultados"}),s.jsx("option",{value:30,children:"30 resultados"}),s.jsx("option",{value:60,children:"60 resultados"}),s.jsx("option",{value:90,children:"90 resultados"})]})]})]}),!c&&p.length>0&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-4 pt-4 border-t border-gray-200",children:[s.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Períodos"}),s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:p.length})]}),s.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total Ventas"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:T(C)})]}),s.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total Transacciones"}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:D})]}),s.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Promedio por Venta"}),s.jsx("p",{className:"text-2xl font-bold text-orange-600",children:T(O)})]})]})]}),x&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[s.jsx(n,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-red-800",children:"Error al cargar ventas"}),s.jsx("p",{className:"text-red-600 text-sm mt-1",children:x})]})]}),c&&s.jsxs("div",{className:"bg-white rounded-xl shadow-md p-12 text-center",children:[s.jsx(o,{className:"w-12 h-12 text-purple-600 animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Cargando totales de ventas..."})]}),!c&&!x&&p.length>0&&s.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"day"===f?"Fecha":"Mes"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Ventas"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transacciones"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Promedio"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map((e,t)=>{const a=e.count>0?e.total/e.count:0;return s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:k(e.date)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600 font-semibold",children:T(e.total)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-semibold",children:e.count}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:T(a)})]},e.date||t)})}),s.jsx("tfoot",{className:"bg-gray-50 border-t-2 border-gray-300",children:s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 text-sm font-bold text-gray-900",children:"TOTAL"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600 font-bold",children:T(C)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-bold",children:D}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-bold",children:T(O)})]})})]})})}),!c&&!x&&0===p.length&&s.jsxs("div",{className:"bg-white rounded-xl shadow-md p-12 text-center",children:[s.jsx(l,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No se encontraron ventas"}),s.jsx("p",{className:"text-gray-600",children:"No hay ventas registradas para el rango de fechas seleccionado"})]})]})};export{c as default};
