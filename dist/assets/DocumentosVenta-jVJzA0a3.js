import{a as e,j as s,l as t}from"./index-BnWi8DhN.js";import{r as a}from"./react-vendor-CfGu_lG-.js";import{D as r}from"./DateRangeFilter-BXr521So.js";import{P as l}from"./Pagination-XVIX5YZQ.js";import{b as i}from"./directApiService-3aVSKyYn.js";import{F as n,D as c,e as d,U as o,f as x,m,n as h}from"./icons-C1UI5Wwr.js";const g=()=>{e("Documentos de Venta - Estadísticas Avanzadas");const[g,u]=a.useState([]),[j,p]=a.useState(!1),[N,y]=a.useState(""),[v,b]=a.useState(null),f=(new Date).toISOString().split("T")[0],[w,S]=a.useState(f),[D,C]=a.useState(f),[P,F]=a.useState(10),[I,E]=a.useState(0),[T,A]=a.useState(!0),[O,V]=a.useState({totalSales:0,documentCount:0}),M=async()=>{p(!0),y("");try{const e=await i(w,D,P,I);if(e.success){const s=e.data.data||[];u(s),A(s.length===P);const a=s.reduce((e,s)=>e+(s.total||0),0);V({totalSales:a,documentCount:s.length}),t.info("Documentos de venta cargados exitosamente",{documents:s.length})}else y(e.error||"Error al cargar documentos de venta"),t.error("Error cargando documentos:",e.error)}catch(e){y("Error inesperado al cargar documentos de venta"),t.error("Error inesperado:",e)}finally{p(!1)}};a.useEffect(()=>{M()},[I]);const k=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e||0),q=Math.floor(I/P)+1;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl shadow-lg p-6 text-white",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(n,{className:"w-8 h-8"}),s.jsx("h1",{className:"text-3xl font-bold",children:"Documentos de Venta"})]}),s.jsx("p",{className:"text-blue-100",children:"Listado detalla do de facturas con información completa de cada transacción"})]}),s.jsx(r,{fromDate:w,toDate:D,onFromDateChange:S,onToDateChange:C,onSubmit:()=>{E(0),M()},loading:j,children:s.jsxs("div",{className:"min-w-[150px]",children:[s.jsx("label",{htmlFor:"limit",className:"block text-sm font-medium text-gray-700 mb-2",children:"Documentos por página"}),s.jsxs("select",{id:"limit",value:P,onChange:e=>{F(Number(e.target.value)),E(0)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none",children:[s.jsx("option",{value:"10",children:"10"}),s.jsx("option",{value:"20",children:"20"}),s.jsx("option",{value:"50",children:"50"})]})]})}),N&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-800",children:N}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Documentos"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:O.documentCount})]}),s.jsx(n,{className:"w-12 h-12 text-blue-500"})]})}),s.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Ventas (Página)"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:k(O.totalSales)})]}),s.jsx(c,{className:"w-12 h-12 text-green-500"})]})})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[j?s.jsx("div",{className:"px-6 py-20 text-center",children:s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Cargando documentos..."})]})}):0===g.length?s.jsx("div",{className:"px-6 py-20 text-center text-gray-500",children:"No se encontraron documentos para el período seleccionado"}):s.jsx("div",{className:"divide-y divide-gray-200",children:g.map((e,t)=>{return s.jsxs("div",{className:"transition-colors hover:bg-gray-50",children:[s.jsx("div",{className:"px-6 py-4 cursor-pointer",onClick:()=>{return s=e.invoiceId,void b(v===s?null:s);var s},children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-5 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Factura"}),s.jsx("p",{className:"text-sm font-semibold text-blue-600",children:e.number||"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Fecha"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(d,{className:"w-3 h-3 text-gray-400 mr-1"}),s.jsx("p",{className:"text-sm text-gray-900",children:(a=e.date,new Date(a).toLocaleDateString("es-CO",{day:"numeric",month:"short",year:"numeric"}))})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Cliente"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(o,{className:"w-3 h-3 text-gray-400 mr-1"}),s.jsx("p",{className:"text-sm text-gray-900 truncate",children:e.client||"Sin especificar"})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Pago"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(x,{className:"w-3 h-3 text-gray-400 mr-1"}),s.jsx("p",{className:"text-sm text-gray-900 capitalize",children:e.paymentMethod||"N/A"})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total"}),s.jsx("p",{className:"text-sm font-bold text-green-600",children:k(e.total)})]})]}),s.jsx("button",{className:"ml-4 text-gray-400 hover:text-gray-600",children:v===e.invoiceId?s.jsx(m,{className:"w-5 h-5"}):s.jsx(h,{className:"w-5 h-5"})})]})}),v===e.invoiceId&&e.items&&e.items.length>0&&s.jsx("div",{className:"px-6 pb-4 bg-gray-50 border-t border-gray-200",children:s.jsxs("div",{className:"pt-4",children:[s.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Items de la factura:"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Producto"}),s.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"Cant."}),s.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"Precio"}),s.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"Subtotal"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.items.map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-3 py-2 text-sm text-gray-900",children:e.name||"Sin nombre"}),s.jsx("td",{className:"px-3 py-2 text-sm text-gray-900 text-right",children:e.quantity||0}),s.jsx("td",{className:"px-3 py-2 text-sm text-gray-900 text-right",children:k(e.price)}),s.jsx("td",{className:"px-3 py-2 text-sm font-semibold text-gray-900 text-right",children:k((e.quantity||0)*(e.price||0))})]},t))})]})}),e.seller&&s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:s.jsxs("p",{className:"text-xs text-gray-500",children:[s.jsx("span",{className:"font-medium",children:"Vendedora:"})," ",e.seller]})})]})})]},e.invoiceId||t);var a})}),!j&&g.length>0&&s.jsx(l,{currentPage:q,onPageChange:e=>{E((e-1)*P)},hasMore:T,itemsPerPage:P})]})]})};export{g as default};
