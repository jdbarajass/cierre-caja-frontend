import{a as e,g as s,j as t}from"./index-CFEYAOzu.js";import{r as a}from"./react-vendor-CfGu_lG-.js";import{g as r}from"./directApiService-D39oPh0Z.js";import{P as l,C as i,l as d,A as n,i as o,N as c,O as x,Z as m,T as h,F as p}from"./icons-yh9a4XSz.js";import g from"./DirectSalesTotals-CT-6T9A3.js";import u from"./DirectSalesDocuments-CEutnlcT.js";const b=()=>{e("Inventario Detallado - Estadísticas Avanzadas");const[m,h]=a.useState(!1),[p,g]=a.useState(null),[u,b]=a.useState([]),[j,y]=a.useState(null),[N,v]=a.useState(s()),[f,w]=a.useState(""),[k,C]=a.useState(100),[S,A]=a.useState(1),I=async()=>{h(!0),g(null);try{const e={toDate:N,limit:k,page:S};f.trim()&&(e.query=f.trim());const s=await r(e);if(!s.success)throw new Error(s.error||"Error al obtener inventario");b(s.data||[]),y(s.metadata||null)}catch(e){g(e.message),b([]),y(null)}finally{h(!1)}};a.useEffect(()=>{I()},[N,k,S]);const _=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e||0),D=u.reduce((e,s)=>e+(s.total_value||0),0),E=u.reduce((e,s)=>e+(s.quantity||0),0);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-teal-600 rounded-xl shadow-lg p-6 text-white",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(l,{className:"w-8 h-8"}),t.jsx("h1",{className:"text-2xl font-bold",children:"Inventario Detallado"})]}),t.jsx("p",{className:"text-green-50",children:"Consulta rápida y completa del inventario directo desde Alegra"})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Filtros"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(i,{className:"w-4 h-4 inline mr-1"}),"Fecha"]}),t.jsx("input",{type:"date",value:N,onChange:e=>{v(e.target.value),A(1)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Items por página"}),t.jsxs("select",{value:k,onChange:e=>{C(Number(e.target.value)),A(1)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[t.jsx("option",{value:50,children:"50 items"}),t.jsx("option",{value:100,children:"100 items"}),t.jsx("option",{value:200,children:"200 items"}),t.jsx("option",{value:500,children:"500 items"}),t.jsx("option",{value:1e3,children:"1000 items (máximo)"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(d,{className:"w-4 h-4 inline mr-1"}),"Buscar producto"]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),A(1),I()},className:"flex gap-2",children:[t.jsx("input",{type:"text",value:f,onChange:e=>w(e.target.value),placeholder:"Nombre del producto...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"}),t.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:t.jsx(d,{className:"w-4 h-4"})}),f&&t.jsx("button",{type:"button",onClick:()=>{w(""),A(1),I()},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:"Limpiar"})]})]})]}),!m&&u.length>0&&t.jsxs("div",{className:"space-y-4 mt-4 pt-4 border-t border-gray-200",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Items Mostrados"}),t.jsx("p",{className:"text-2xl font-bold text-green-600",children:u.length})]}),t.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Cantidad Total"}),t.jsx("p",{className:"text-2xl font-bold text-blue-600",children:E})]}),t.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Valor Total"}),t.jsx("p",{className:"text-2xl font-bold text-purple-600",children:_(D)})]})]}),j&&(j.total_filtered>0||j.total_received)&&t.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"w-5 h-5 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-sm font-semibold text-yellow-800",children:"Filtrado automático aplicado"}),t.jsxs("div",{className:"mt-2 text-sm text-yellow-700 space-y-1",children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Items en Alegra:"})," ",j.total_received||0]}),j.total_filtered>0&&t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Items obsoletos filtrados:"})," ",j.total_filtered,t.jsx("span",{className:"text-xs ml-1",children:"(productos con * al inicio)"})]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Items válidos mostrados:"})," ",j.total_returned||u.length]})]})]})]})})]})]}),p&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[t.jsx(n,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-red-800",children:"Error al cargar inventario"}),t.jsx("p",{className:"text-red-600 text-sm mt-1",children:p})]})]}),m&&t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-12 text-center",children:[t.jsx(o,{className:"w-12 h-12 text-green-600 animate-spin mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Cargando inventario..."})]}),!m&&!p&&u.length>0&&t.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Referencia"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cantidad"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio Unit."}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Total"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.id}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.name||"Sin nombre"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.reference||"-"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-semibold",children:e.quantity||0}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:_(e.unit_price)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600 font-semibold",children:_(e.total_value)})]},e.id||s))})]})}),j&&t.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Página ",j.page||S," de ",j.total_pages||1," ","(",j.total_items||0," items totales)"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>A(e=>Math.max(1,e-1)),disabled:1===S,className:"px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[t.jsx(c,{className:"w-4 h-4"}),"Anterior"]}),t.jsxs("button",{onClick:()=>A(e=>e+1),disabled:!j.total_pages||S>=j.total_pages,className:"px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:["Siguiente",t.jsx(x,{className:"w-4 h-4"})]})]})]})]}),!m&&!p&&0===u.length&&t.jsxs("div",{className:"bg-white rounded-xl shadow-md p-12 text-center",children:[t.jsx(l,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No se encontraron productos"}),t.jsx("p",{className:"text-gray-600",children:f?"Intenta con otro término de búsqueda":"No hay productos en el inventario para esta fecha"})]})]})},j=()=>{e("Estadísticas Avanzadas");const[s,r]=a.useState("inventory"),i=[{id:"inventory",label:"Inventario",icon:l,color:"green",component:b},{id:"sales-totals",label:"Totales de Ventas",icon:h,color:"purple"},{id:"sales-documents",label:"Documentos",icon:p,color:"blue"}],d=(e,s)=>{if(s){return{green:"bg-green-600 text-white",purple:"bg-purple-600 text-white",blue:"bg-blue-600 text-white"}[e]||"bg-gray-600 text-white"}return{green:"text-green-700 hover:bg-green-50",purple:"text-purple-700 hover:bg-purple-50",blue:"text-blue-700 hover:bg-blue-50"}[e]||"text-gray-700 hover:bg-gray-50"};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-gradient-to-r from-yellow-400 via-yellow-500 to-orange-500 rounded-xl shadow-lg p-6 text-white",children:t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(m,{className:"w-10 h-10"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Estadísticas Avanzadas"}),t.jsx("p",{className:"text-yellow-50 mt-1",children:"APIs directas de Alegra - Consultas rápidas y completas"})]})]})}),t.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(m,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold text-blue-900",children:"¿Qué son las Estadísticas Avanzadas?"}),t.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Estas estadísticas consultan directamente las APIs de Alegra, ofreciendo:"}),t.jsxs("ul",{className:"text-sm text-blue-700 mt-2 space-y-1 list-disc list-inside",children:[t.jsx("li",{children:"Respuestas más rápidas y eficientes"}),t.jsx("li",{children:"Datos calculados directamente por Alegra"}),t.jsx("li",{children:"Ideal para reportes y dashboards en tiempo real"})]})]})]})}),t.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsx("nav",{className:"flex",children:i.map(e=>{const a=e.icon,l=s===e.id;return t.jsxs("button",{onClick:()=>r(e.id),className:"flex-1 flex items-center justify-center gap-2 px-6 py-4 text-sm font-medium transition-colors border-b-2 "+(l?`border-${e.color}-600 ${d(e.color,!0)}`:`border-transparent ${d(e.color,!1)}`),children:[t.jsx(a,{className:"w-5 h-5"}),t.jsx("span",{children:e.label})]},e.id)})})}),t.jsxs("div",{className:"p-6",children:["inventory"===s&&t.jsx(b,{}),"sales-totals"===s&&t.jsx(g,{}),"sales-documents"===s&&t.jsx(u,{})]})]})]})};export{j as default};
